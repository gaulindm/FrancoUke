<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Isometric Cube â€” Left-hand Teaching Orientation</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { 
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; 
      padding: 18px; 
      background: #f5f5f5;
    }
    #controls {
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background: #2E7D32;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background: #1B5E20;
    }
    #cube-wrapper { 
      width: 600px; 
      max-width: 95vw; 
      margin: 18px 0;
      background: #f0fdf4;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .sticker { 
      stroke: #0F0F0F; 
      stroke-width: 3; 
      vector-effect: non-scaling-stroke; 
      cursor: pointer;
      transition: opacity 0.2s;
    }
    .sticker:hover {
      opacity: 0.8;
    }
    .sticker-hidden {
      stroke: #f5f5f5;
      stroke-width: 4;
      cursor: pointer;
      transition: transform 0.5s ease-out, opacity 0.3s;
    }
    .sticker-hidden:hover {
      opacity: 0.8;
    }
    /* Face groups with transitions */
    #face-L, #face-D, #face-B {
      transition: transform 0.5s ease-out;
    }
    .info {
      margin-top: 10px;
      padding: 10px;
      background: #E3F2FD;
      border-radius: 4px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <h1>Isometric Cube â€” Left-hand Teaching Orientation (All Faces Programmatic)</h1>

  <div id="controls">
    <button onclick="copyToClipboard()">ðŸ“‹ Copy to Clipboard</button>
    <button onclick="exportAsImage()">ðŸ“¥ Download PNG</button>
    <button onclick="resetAllGrey()">ðŸ”„ Reset All to Grey</button>

    <div style="margin: 15px 0;">
      <label style="font-weight: 600; margin-right: 10px;">Hidden Face Visibility:</label>
      <select id="projection-mode" onchange="changeProjectionMode(this.value)" style="padding: 8px; font-size: 14px; border-radius: 4px; border: 1px solid #ccc;">
        <option value="1">Projection 1 - Completely Hidden</option>
        <option value="2">Projection 2 - Subtle Visibility</option>
        <option value="3">Projection 3 - Medium Visibility</option>
        <option value="4" selected>Projection 4 - High Visibility</option>
      </select>
    </div>

    <div class="info">
      <strong>Tip:</strong> Click any sticker to cycle colors.  
      Use <strong>Copy to Clipboard</strong> â†’ paste directly into Google Slides.
    </div>
  </div>

  <div id="cube-wrapper">
    <svg id="cube-svg" width="600" height="500" viewBox="0 0 600 500"
         xmlns="http://www.w3.org/2000/svg" role="img">
      <style>.sticker { stroke-linejoin: round; }</style>

      <rect width="600" height="500" fill="#f0fdf4" />

      <g id="cube" transform="rotate(0 0 0)"></g>
    </svg>
  </div>

  <script>
    // =========================
    // Projection Mode
    // =========================
    let currentProjection = 4;

    // Projection multipliers and scale factors
    const PROJECTION_CONFIG = {
      1: { offset: 0, scale: 1.0 },
      2: { offset: 0.25, scale: 0.9 },
      3: { offset: 0.5, scale: .95 },
      4: { offset: 1, scale: 1 }
    };

    function changeProjectionMode(mode) {
      currentProjection = parseInt(mode);
      const config = PROJECTION_CONFIG[currentProjection];
      const multiplier = config.offset;
      const scale = config.scale;
      
      // Base offset distances for each face
      const offsets = {
        L: { x: -100 * multiplier, y: 0 },      // Move left
        D: { x: 0, y: 80 * multiplier },        // Move down
        B: { x: 100 * multiplier, y: 0 }        // Move right
      };

      // Apply transforms to hidden faces
      const faceL = document.getElementById('face-L');
      const faceD = document.getElementById('face-D');
      const faceB = document.getElementById('face-B');

      if (faceL) {
        // Calculate center point for L face (approximate)
        const centerX = 62.5;  // Middle of L face
        const centerY = 220;
        faceL.style.transformOrigin = `${centerX}px ${centerY}px`;
        faceL.style.transform = `translate(${offsets.L.x}px, ${offsets.L.y}px) scale(${scale})`;
        faceL.style.opacity = multiplier === 0 ? '0' : '1';
      }
      if (faceD) {
        // Calculate center point for D face
        const centerX = 260;
        const centerY = 397.5;
        faceD.style.transformOrigin = `${centerX}px ${centerY}px`;
        faceD.style.transform = `translate(${offsets.D.x}px, ${offsets.D.y}px) scale(${scale})`;
        faceD.style.opacity = multiplier === 0 ? '0' : '1';
      }
      if (faceB) {
        // Calculate center point for B face
        const centerX = 475;
        const centerY = 175;
        faceB.style.transformOrigin = `${centerX}px ${centerY}px`;
        faceB.style.transform = `translate(${offsets.B.x}px, ${offsets.B.y}px) scale(${scale})`;
        faceB.style.opacity = multiplier === 0 ? '0' : '1';
      }
      
      console.log(`Projection mode changed to: ${currentProjection} (offset: ${multiplier}, scale: ${scale})`);
    }

    // =========================
    // Constants
    // =========================
    const DARK_GREY = '#BBBBBB';
    const CUBE_SIZE = 4;
  
    const PALETTE = { 
      U:'#FFFFFF', 
      R:'#D32F2F', 
      F:'#2E7D32', 
      D:'#FFEB3B', 
      L:'#F57C00', 
      B:'#1565C0',
      G: DARK_GREY
    };

    // Face configurations
    const FACES = {
      U: {
        origin: { x: 220, y: 40 },
        dx: { x: 50, y: 10 },
        dy: { x: -30, y: 15 },
        visible: true
      },
      R: {
        origin: { x: 300, y: 140 },
        dx: { x: 30, y: -15 },
        dy: { x: 0, y: 60 },
        visible: true
      },
      F: {
        origin: { x: 100, y: 100 },
        dx: { x: 50, y: 10 },
        dy: { x: 0, y: 60 },
        visible: true
      },
      D: {
        origin: { x: 230, y: 275 },
        dx: { x: 50, y: 10 },
        dy: { x: -30, y: 15 },
        visible: false
      },
      L: {
        origin: { x: 110, y: 100 },
        dx: { x: 25, y: -15 },
        dy: { x: 0, y: 50 },
        visible: false
      },
      B: {
        origin: { x: 300, y: 40 },
        dx: { x: 40.5, y: 7.5 },
        dy: { x: 0, y: 45 },
        visible: false
      }
    };

    // =========================
    // Sticker Points Generator
    // =========================
    function getStickerPoints(face, row, col) {
      const config = FACES[face];
      const o = config.origin;
      const dx = config.dx;
      const dy = config.dy;

      const p0 = {
        x: o.x + col * dx.x + row * dy.x,
        y: o.y + col * dx.y + row * dy.y
      };

      const p1 = {
        x: p0.x + dx.x,
        y: p0.y + dx.y
      };

      const p2 = {
        x: p1.x + dy.x,
        y: p1.y + dy.y
      };

      const p3 = {
        x: p0.x + dy.x,
        y: p0.y + dy.y
      };

      return `${p0.x},${p0.y} ${p1.x},${p1.y} ${p2.x},${p2.y} ${p3.x},${p3.y}`;
    }

    // =========================
    // Draw Face
    // =========================
    function drawFace(faceName) {
      const config = FACES[faceName];
      const faceGroup = document.createElementNS(
        'http://www.w3.org/2000/svg',
        'g'
      );
      faceGroup.setAttribute('id', `face-${faceName}`);

      for (let r = 0; r < CUBE_SIZE; r++) {
        for (let c = 0; c < CUBE_SIZE; c++) {
          const poly = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'polygon'
          );

          poly.setAttribute('id', `sticker-${faceName}-${r}-${c}`);
          poly.setAttribute('class', config.visible ? 'sticker' : 'sticker-hidden');
          poly.setAttribute('points', getStickerPoints(faceName, r, c));
          poly.setAttribute('fill', DARK_GREY);

          faceGroup.appendChild(poly);
        }
      }

      return faceGroup;
    }

    // =========================
    // Initialization
    // =========================
    function initializeCube() {
      const cubeGroup = document.getElementById('cube');
      
      // Clear existing faces
      cubeGroup.innerHTML = '';
      
      // Draw all faces in correct order (back to front for proper layering)
      ['L', 'D', 'B', 'R', 'F', 'U'].forEach(face => {
        cubeGroup.appendChild(drawFace(face));
      });

      // Add click handlers
      document.querySelectorAll('.sticker, .sticker-hidden').forEach(el => {
        el.addEventListener('click', () => {
          const colors = Object.values(PALETTE);
          const current = el.getAttribute('fill') || colors[0];
          const next = colors[(colors.indexOf(current) + 1) % colors.length];
          el.setAttribute('fill', next);
        });
      });
    }

    function resetAllGrey() {
      document.querySelectorAll('.sticker, .sticker-hidden').forEach(el => {
        el.setAttribute('fill', DARK_GREY);
      });
    }

    // =========================
    // Export Functions
    // =========================
    function inlineStickerStrokes() {
      document.querySelectorAll('.sticker').forEach(el => {
        el.setAttribute('stroke', '#0F0F0F');
        el.setAttribute('stroke-width', '2');
        el.removeAttribute('vector-effect');
      });
      
      document.querySelectorAll('.sticker-hidden').forEach(el => {
        el.setAttribute('stroke', '#0F0F0F');
        el.setAttribute('stroke-width', '2');
        el.removeAttribute('vector-effect');
      });
    }
  
    function exportAsImage() {
      const svg = document.getElementById('cube-svg');
      inlineStickerStrokes();
  
      const svgData = new XMLSerializer().serializeToString(svg);
      const canvas = document.createElement('canvas');
      canvas.width = 600;
      canvas.height = 500;
  
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#f0fdf4';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
  
      const img = new Image();
      const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(svgBlob);
  
      img.onload = () => {
        ctx.drawImage(img, 0, 0);
        URL.revokeObjectURL(url);
  
        canvas.toBlob(blob => {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = 'rubiks-cube.png';
          a.click();
          URL.revokeObjectURL(a.href);
        });
      };
  
      img.src = url;
    }
  
    async function copyToClipboard() {
      const svg = document.getElementById('cube-svg');
      inlineStickerStrokes();
  
      const svgData = new XMLSerializer().serializeToString(svg);
      const canvas = document.createElement('canvas');
      canvas.width = 600;
      canvas.height = 500;
  
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#f0fdf4';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
  
      const img = new Image();
      const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(svgBlob);
  
      img.onload = async () => {
        ctx.drawImage(img, 0, 0);
        URL.revokeObjectURL(url);
  
        canvas.toBlob(async pngBlob => {
          await navigator.clipboard.write([
            new ClipboardItem({ 'image/png': pngBlob })
          ]);
          alert('Cube copied to clipboard! Paste into Google Slides.');
        });
      };
  
      img.src = url;
    }
  
    // =========================
    // Startup
    // =========================
    initializeCube();
    changeProjectionMode(4); // Set initial projection
  
    // Expose functions
    window.exportAsImage = exportAsImage;
    window.copyToClipboard = copyToClipboard;
    window.resetAllGrey = resetAllGrey;
    window.changeProjectionMode = changeProjectionMode;
  </script>
  
</body>
</html>
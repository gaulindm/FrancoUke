{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}La marguerite â€” Francontcube{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Titre principal -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            ğŸŒ¼ Ã‰tape 1 : <span class="brand-green">Fais une marguerite!</span>
        </h1>
        <p class="lead">
            Mets 4 pÃ©tales blancs autour du centre jaune
        </p>
    </div>

    <!-- Charger le template SVG (cachÃ©) -->
    {% include "cube/partials/_cube_svg.html" %}

    <!-- Warning for missing cube states (only shown if any are missing) -->
    {% if missing_slugs %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">âš ï¸ Missing Cube States</h4>
        <p>The following CubeState objects need to be created in the database:</p>
        <ul class="mb-0">
            {% for slug in missing_slugs %}
            <li><code>{{ slug }}</code></li>
            {% endfor %}
        </ul>
        <hr>
        <p class="mb-0 small">Use your cube state creation tool to add these. The page will display placeholders until they're created.</p>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <!-- Section Objectif -->
    <!-- C'est quoi le but? -->
    <div class="card border-success border-3 shadow-sm mb-4">
        <div class="card-body text-center p-5">
            <h2 class="mb-4">ğŸ¯ C'est quoi le but?</h2>
            <div id="cube-goal" class="mb-3"></div>
            <h4 class="brand-green">Faire une fleur avec 4 pÃ©tales blancs!</h4>
            <p class="lead mb-0">Les pÃ©tales blancs doivent entourer le centre jaune â˜€ï¸</p>
        </div>
    </div>

    <!-- Section Comment faire -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ§© Comment faire ?</h3>

        <ol class="mt-3">
            <li>Trouve une arÃªte blanche n'importe oÃ¹ sur le cube.</li>
            <li>AmÃ¨ne l'arÃªte blanche sur la <strong>face jaune</strong>.</li>
            <li>RÃ©pÃ¨te pour les 4 arÃªtes blanches.</li>
        </ol>

        <p class="mt-3">
            Pour cette Ã©tape, aucun algorithme n'est requis.  
            <strong>Utilise seulement tes intuitions et des rotations simples !</strong>
        </p>

        <!-- Comparaison Avant/AprÃ¨s -->
        <div class="row mt-4">
            <div class="col-md-6 text-center mb-3">
                <h5 class="brand-green">Avant</h5>
                <div id="cube-before"></div>
                <p><small class="text-muted">ArÃªtes blanches dispersÃ©es sur le cube</small></p>
            </div>
            <div class="col-md-6 text-center mb-3">
                <h5 class="brand-green">AprÃ¨s</h5>
                <div id="cube-after"></div>
                <p><small class="text-muted">Marguerite complÃ¨te!</small></p>
            </div>
        </div>
    </div>

    <!-- Section Progression interactive -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ“Š Ta progression</h3>
        <p>Clique sur les boutons pour voir comment la marguerite se construit Ã©tape par Ã©tape.</p>
        
        <div class="text-center mt-3">
            <div id="cube-container-progress"></div>
            <div class="btn-group mt-3" role="group" aria-label="Progression de la marguerite">
                <button class="btn btn-sm btn-outline-primary active" onclick="updateProgress(0)">0/4</button>
                <button class="btn btn-sm btn-outline-primary" onclick="updateProgress(1)">1/4</button>
                <button class="btn btn-sm btn-outline-primary" onclick="updateProgress(2)">2/4</button>
                <button class="btn btn-sm btn-outline-primary" onclick="updateProgress(3)">3/4</button>
                <button class="btn btn-sm btn-outline-success" onclick="updateProgress(4)">4/4 âœ“</button>
            </div>
            <div id="progress-message" class="mt-3 p-3 bg-light rounded" style="display: none;">
                <p class="mb-0 text-center fw-bold"></p>
            </div>
        </div>
    </div>

    <!-- Section Conseils -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ’¡ Conseils utiles</h3>
        <ul class="mt-3">
            <li>Tourne le cube dans tes mains pour repÃ©rer les arÃªtes blanches.</li>
            <li>Si une arÃªte blanche est Â« coincÃ©e Â» en bas, utilise <code>R U R'</code> pour la libÃ©rer.</li>
            <li>Ne t'en fais pas pour les couleurs autour â€“ ce sera important Ã  l'Ã©tape suivante !</li>
            <li><strong>Astuce :</strong> Commence par trouver UNE arÃªte blanche, puis concentre-toi sur celle-lÃ  avant de chercher les autres.</li>
        </ul>
    </div>

    <!-- Bouton de navigation -->
    <div class="text-center">
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-outline-primary">
            â† Retour aux Ã©tapes
        </a>
        <a href="{% url 'francontcube:cubienewbie_white_cross' %}" class="btn btn-success ms-2">
            Ã‰tape suivante : La croix blanche â†’
        </a>
    </div>
</div>

<!-- Styles CSS pour les cubes -->
<style>
/* Cube de taille normale (pour objectif et progression) */
#cube-container-goal svg,
#cube-container-progress svg {
    max-width: 100%;
    height: auto;
}

/* Cubes rÃ©duits Ã  1/4 (pour avant/aprÃ¨s) */
.cube-small svg {
    max-width: 275px;  /* 550px / 2 */
    height: auto;
}

/* Sur mobile, garder les cubes plus petits */
@media (max-width: 768px) {
    .cube-small svg {
        max-width: 200px;
    }
    
    #cube-container-goal svg,
    #cube-container-progress svg {
        max-width: 350px;
    }
}
</style>
<script type="module">
  import { renderCube } from "{% static 'cube/js/cube_renderer.js' %}";

  function mountCube(containerId, state) {
    const container = document.getElementById(containerId);
    container.innerHTML = ''; // Clear any existing content
    
    // If state is missing, show a placeholder
    if (!state) {
      container.innerHTML = `
        <div class="alert alert-secondary text-center py-4">
          <i class="bi bi-cube text-muted" style="font-size: 3rem;"></i>
          <p class="mb-0 mt-2 text-muted">Cube state not available</p>
          <small class="text-muted">Create the CubeState in your admin tool</small>
        </div>
      `;
      return;
    }
    
    const template = document.getElementById("cube-template");
    const clone = template.content.cloneNode(true);
    container.appendChild(clone);

    const svg = container.querySelector("svg");
    renderCube(svg, state);
  }

  document.addEventListener("DOMContentLoaded", () => {
    mountCube("cube-goal", {{ goal_state|safe }});
    mountCube("cube-before", {{ before_state|safe }});
    mountCube("cube-after", {{ after_state|safe }});
  });
</script>

{% endblock %}
{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}La croix jaune â€” Francontcube{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Titre principal -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            Ã‰tape 4 : <span class="brand-green">La croix jaune</span>
        </h1>
        <p class="lead text-muted">
            Former une croix jaune sur la face du haut en orientant les arÃªtes.
        </p>
    </div>

    <!-- Charger le template SVG (cachÃ©) -->
    {% include "cube/partials/_cube_svg.html" %}

    <!-- Warning for missing cube states (only shown if any are missing) -->
    {% if missing_slugs %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">âš ï¸ Missing Cube States</h4>
        <p>The following CubeState objects need to be created in the database:</p>
        <ul class="mb-0">
            {% for slug in missing_slugs %}
            <li><code>{{ slug }}</code></li>
            {% endfor %}
        </ul>
        <hr>
        <p class="mb-0 small">Use your cube state creation tool to add these. The page will display placeholders until they're created.</p>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <!-- Section Objectif -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ¯ Objectif</h3>
        <p>
            Former une <strong>croix jaune</strong> sur la face du haut. 
            <strong>Important :</strong> Pour l'instant, on s'occupe seulement de la face jaune - 
            pas des couleurs sur les cÃ´tÃ©s!
        </p>

        <div class="row mt-3">
            <div class="col-md-6 text-center mb-3">
                <h5>Avant : Deux couches complÃ¨tes</h5>
                <div id="cube-before" class="cube-small"></div>
                <p><small class="text-muted">Les deux premiÃ¨res couches sont terminÃ©es</small></p>
            </div>
            <div class="col-md-6 text-center mb-3">
                <h5>AprÃ¨s : Croix jaune</h5>
                <div id="cube-goal" class="cube-small"></div>
                <p><small class="text-muted">Croix jaune formÃ©e sur le dessus</small></p>
            </div>
        </div>
    </div>

    <!-- Section Les 3 patterns -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ” Ã‰tape 1 : Identifie le pattern sur la face jaune</h3>
        <p>
            Regarde la face du haut. Tu verras un des 3 patterns suivants (ou dÃ©jÃ  une croix!).
        </p>

        <div class="row mt-3">
            <!-- Pattern Point -->
            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>Pattern 1: Point</h5>
                    <div id="cube-pattern-dot" class="cube-case"></div>
                    <p class="mt-2"><small>Juste le centre jaune</small></p>
                </div>
            </div>

            <!-- Pattern L -->
            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>Pattern 2: L</h5>
                    <div id="cube-pattern-l" class="cube-case"></div>
                    <p class="mt-2"><small>Centre + 2 arÃªtes en L</small></p>
                </div>
            </div>

            <!-- Pattern Ligne -->
            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>Pattern 3: Ligne</h5>
                    <div id="cube-pattern-line" class="cube-case"></div>
                    <p class="mt-2"><small>Centre + ligne horizontale</small></p>
                </div>
            </div>
        </div>

        <div class="alert alert-success mt-3">
            <strong>âœ… Si tu as dÃ©jÃ  une croix jaune :</strong> Super! Passe directement Ã  l'Ã©tape suivante!
        </div>
    </div>

    <!-- Section L'algorithme -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ”„ Ã‰tape 2 : Applique l'algorithme</h3>
        <p>
            Un seul algorithme pour tous les cas! Il faut juste bien <strong>orienter le cube</strong> 
            avant de commencer.
        </p>

        <div class="text-center p-4 bg-light rounded border border-success border-3 mb-3">
            <h2 class="mb-2">
                <code class="fs-1 text-success">F R U R' U' F'</code>
            </h2>
            <p class="mb-0"><small>L'algorithme de la croix jaune</small></p>
        </div>

        <div class="alert alert-info">
            <strong>ğŸ’¡ DÃ©composition :</strong>
            <ul class="mb-0 mt-2">
                <li><code>F</code> = Face avant (sens horaire)</li>
                <li><code>R</code> = Face droite (sens horaire)</li>
                <li><code>U</code> = Face du haut (sens horaire)</li>
                <li><code>R'</code> = Face droite (sens anti-horaire)</li>
                <li><code>U'</code> = Face du haut (sens anti-horaire)</li>
                <li><code>F'</code> = Face avant (sens anti-horaire)</li>
            </ul>
        </div>
    </div>

    <!-- Section Comment orienter -->
    <div class="card p-4 mb-4 border-warning">
        <h3 class="brand-green">âš ï¸ Comment orienter le cube (TRÃˆS IMPORTANT!)</h3>

        <div class="border rounded p-3 mb-3 bg-light">
            <h5 class="text-danger">Pattern 1: Point (juste le centre)</h5>
            <p>
                <strong>Orientation :</strong> Peu importe! Tu peux faire l'algorithme dans n'importe quelle direction.
            </p>
            <p class="mb-0">
                <strong>RÃ©sultat :</strong> Tu obtiendras le pattern L
            </p>
        </div>

        <div class="border rounded p-3 mb-3 bg-light">
            <h5 class="text-warning">Pattern 2: L</h5>
            <p>
                <strong>Orientation :</strong> Place le L en <strong>bas Ã  gauche</strong> (les deux arÃªtes jaunes 
                pointent vers le bas et vers la gauche).
            </p>
            <p class="mb-0">
                <strong>RÃ©sultat :</strong> Tu obtiendras une ligne
            </p>
        </div>

        <div class="border rounded p-3 bg-light">
            <h5 class="text-primary">Pattern 3: Ligne</h5>
            <p>
                <strong>Orientation :</strong> Place la ligne <strong>horizontale</strong> 
                (de gauche Ã  droite, pas de haut en bas).
            </p>
            <p class="mb-0">
                <strong>RÃ©sultat :</strong> Tu obtiendras la croix jaune! âœ“
            </p>
        </div>
    </div>

    <!-- Section Technique -->
    <div class="card p-4 mb-4 border-success">
        <h3 class="brand-green">âœ‹ Technique de prise</h3>
        <div class="alert alert-success mb-0">
            <strong>Pour F R U R' U' F' :</strong>
            <ul class="mb-0 mt-2">
                <li>Main gauche : tiens le cube et fait les mouvements F et F'</li>
                <li>Main droite : fait les mouvements R, U, R', U'</li>
                <li><strong>C'est trÃ¨s similaire Ã  R U R' U'</strong> que tu connais dÃ©jÃ !</li>
                <li>Pratique lentement jusqu'Ã  ce que ce soit fluide</li>
            </ul>
        </div>
    </div>

    <!-- Section Processus complet -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ“‹ Processus complet</h3>
        <ol>
            <li class="mb-2">
                <strong>Regarde la face du haut</strong> : Identifie quel pattern tu as (Point, L ou Ligne)
            </li>
            <li class="mb-2">
                <strong>Oriente le cube correctement</strong> :
                <ul>
                    <li>Point â†’ Peu importe</li>
                    <li>L â†’ En bas Ã  gauche</li>
                    <li>Ligne â†’ Horizontale (gauche-droite)</li>
                </ul>
            </li>
            <li class="mb-2">
                <strong>Fais l'algorithme</strong> : <code>F R U R' U' F'</code>
            </li>
            <li class="mb-2">
                <strong>VÃ©rifie le rÃ©sultat</strong> : 
                <ul>
                    <li>Si tu n'as pas encore la croix, rÃ©pÃ¨te le processus</li>
                    <li>Si tu as la croix, fÃ©licitations! Passe Ã  l'Ã©tape suivante</li>
                </ul>
            </li>
        </ol>

        <div class="alert alert-info mt-3 mb-0">
            <strong>ğŸ’¡ Combien de fois ?</strong>
            <ul class="mb-0">
                <li>Point â†’ L (1 fois) â†’ Ligne (2 fois) â†’ Croix (3 fois)</li>
                <li>L â†’ Ligne (1 fois) â†’ Croix (2 fois)</li>
                <li>Ligne â†’ Croix (1 fois)</li>
            </ul>
        </div>
    </div>

    <!-- Section Conseils -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ’¡ Conseils utiles</h3>
        <ul class="mt-3">
            <li>
                <strong>Ne t'inquiÃ¨te pas si les deux premiÃ¨res couches se dÃ©font!</strong> 
                C'est normal - on ne regarde que la face jaune pour l'instant.
            </li>
            <li>
                <strong>L'orientation est cruciale.</strong> Si tu ne mets pas le cube dans la bonne 
                position avant de faire l'algorithme, Ã§a ne marchera pas!
            </li>
            <li>
                <strong>Pratique F R U R' U' F' jusqu'Ã  ce que ce soit automatique.</strong> 
                C'est un algorithme que tu utiliseras souvent.
            </li>
            <li>
                <strong>Maximum 3 rÃ©pÃ©titions.</strong> Si tu as fait l'algorithme 3 fois et que 
                tu n'as toujours pas la croix, vÃ©rifie ton orientation!
            </li>
            <li>
                Une fois la croix formÃ©e, <strong>ne te prÃ©occupe pas encore des couleurs sur les cÃ´tÃ©s</strong> - 
                on s'occupera de Ã§a Ã  l'Ã©tape suivante! ğŸ‰
            </li>
        </ul>
    </div>

    <!-- Bouton de navigation -->
    <div class="text-center">
        <a href="{% url 'francontcube:second_layer' %}" class="btn btn-outline-primary">
            â† Retour : La deuxiÃ¨me couche
        </a>
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-outline-secondary ms-2">
            Vue d'ensemble
        </a>
            <a href="{% url 'francontcube:yellow_face' %}" class="btn btn-success ms-2">
                Ã‰tape suivante : La face jaune â†’
            </a>
    </div>
</div>

<!-- Styles CSS pour les cubes -->
<style>
.cube-small svg {
    max-width: 275px;
    height: auto;
}

.cube-case svg {
    max-width: 200px;
    height: auto;
}

@media (max-width: 768px) {
    .cube-small svg {
        max-width: 200px;
    }
    
    .cube-case svg {
        max-width: 150px;
    }
}
</style>

<!-- Script d'initialisation de la page -->
<script type="module">
  import { renderCube } from "{% static 'cube/js/cube_renderer.js' %}";

  function mountCube(containerId, state) {
    const container = document.getElementById(containerId);
    container.innerHTML = ''; // Clear any existing content
    
    // If state is missing, show a placeholder
    if (!state) {
      container.innerHTML = `
        <div class="alert alert-secondary text-center py-4">
          <i class="bi bi-cube text-muted" style="font-size: 3rem;"></i>
          <p class="mb-0 mt-2 text-muted">Cube state not available</p>
          <small class="text-muted">Create the CubeState in your admin tool</small>
        </div>
      `;
      return;
    }
    
    const template = document.getElementById("cube-template");
    const clone = template.content.cloneNode(true);
    container.appendChild(clone);

    const svg = container.querySelector("svg");
    renderCube(svg, state);
  }

  document.addEventListener("DOMContentLoaded", () => {
    // Mount all cubes
    mountCube("cube-before", {{ before_state|safe }});
    mountCube("cube-goal", {{ goal_state|safe }});
    
    // Pattern states
    mountCube("cube-pattern-dot", {{ pattern_dot_state|safe }});
    mountCube("cube-pattern-l", {{ pattern_l_state|safe }});
    mountCube("cube-pattern-line", {{ pattern_line_state|safe }});
  });
</script>

{% endblock %}
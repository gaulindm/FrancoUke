{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}La face jaune ‚Äî Francontcube{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Titre principal -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            √âtape 5 : <span class="brand-green">La face jaune compl√®te</span>
        </h1>
        <p class="lead text-muted">
            Orienter les 4 coins jaunes pour compl√©ter toute la face jaune - la chasse au poisson!
        </p>
    </div>

    <!-- Charger le template SVG (cach√©) -->
    {% include "cube/partials/_cube_svg.html" %}

    <!-- Warning for missing cube states (only shown if any are missing) -->
    {% if missing_slugs %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">‚ö†Ô∏è Missing Cube States</h4>
        <p>The following CubeState objects need to be created in the database:</p>
        <ul class="mb-0">
            {% for slug in missing_slugs %}
            <li><code>{{ slug }}</code></li>
            {% endfor %}
        </ul>
        <hr>
        <p class="mb-0 small">Use your cube state creation tool to add these. The page will display placeholders until they're created.</p>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <!-- Section Objectif -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üéØ Objectif</h3>
        <p>
            Maintenant que tu as la croix jaune, il faut <strong>orienter les 4 coins</strong> 
            pour que toute la face du haut soit jaune.
        </p>

        <div class="row mt-3">
            <div class="col-md-6 text-center mb-3">
                <h5>Avant : Croix jaune</h5>
                <div id="cube-before" class="cube-small"></div>
                <p><small class="text-muted">Croix form√©e, mais les coins ne sont pas tous jaunes</small></p>
            </div>
            <div class="col-md-6 text-center mb-3">
                <h5>Apr√®s : Face jaune compl√®te</h5>
                <div id="cube-goal" class="cube-small"></div>
                <p><small class="text-muted">Toute la face du haut est jaune!</small></p>
            </div>
        </div>
    </div>

    <!-- Section La chasse au poisson -->
    <div class="card p-4 mb-4 border-primary">
        <h3 class="brand-green">üêü La chasse au poisson</h3>
        <p>
            Cette √©tape s'appelle "la chasse au poisson" parce qu'on cherche un pattern 
            sp√©cial qui ressemble √† un poisson!
        </p>

        <div class="alert alert-info">
            <strong>üí° Le principe :</strong>
            <ol class="mb-0 mt-2">
                <li>Cherche le "poisson" sur la face jaune</li>
                <li>Oriente le cube pour que le poisson soit dans la bonne position</li>
                <li>Fais l'algorithme</li>
                <li>R√©p√®te jusqu'√† ce que toute la face soit jaune</li>
            </ol>
        </div>

        <div class="row mt-3">
            <div class="col-md-6 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5 class="text-primary">Poisson gauche</h5>
                    <div id="cube-fish-left" class="cube-case"></div>
                    <p class="mt-2"><small>Le poisson regarde vers la gauche</small></p>
                </div>
            </div>
            <div class="col-md-6 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5 class="text-success">Poisson droit</h5>
                    <div id="cube-fish-right" class="cube-case"></div>
                    <p class="mt-2"><small>Le poisson regarde vers la droite</small></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Section L'algorithme -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üîÑ L'algorithme du poisson</h3>
        <p>
            Un seul algorithme pour compl√©ter la face jaune! C'est le m√™me que pour 
            les coins blancs, mais r√©p√©t√© plusieurs fois.
        </p>

        <div class="text-center p-4 bg-light rounded border border-success border-3 mb-3">

            <div class="d-flex justify-content-center align-items-center gap-2 my-2 flex-wrap">

                <svg class="move-icon"><use href="#R"/></svg>
                <svg class="move-icon"><use href="#U"/></svg>
                <svg class="move-icon"><use href="#R-prime"/></svg>
                <svg class="move-icon"><use href="#U"/></svg>
                <svg class="move-icon"><use href="#R"/></svg>
                <svg class="move-icon"><use href="#U2"/></svg>
                <svg class="move-icon"><use href="#R-prime"/></svg>
            </div> 
            <p class="mb-0"><small>L'algorithme du poisson (aussi appel√© "Sune")</small></p>
        </div>


        <div class="alert alert-success mt-3">
            <strong>‚úã Technique de prise :</strong>
            <ul class="mb-0 mt-2">
                <li>Main gauche : tiens le cube fermement</li>
                <li>Main droite : fait tous les mouvements</li>
                <li>Pouce droit : R et R'</li>
                <li>Index droit : U et U2</li>
            </ul>
        </div>
    </div>

    <!-- Section Comment orienter -->
    <div class="card p-4 mb-4 border-warning">
        <h3 class="brand-green">‚ö†Ô∏è Comment orienter le poisson (CRUCIAL!)</h3>

        <div class="row align-items-center mb-3">
            <div class="col-md-8">
                <p>
                    <strong>Si tu vois un poisson :</strong>
                </p>
                <ol>
                    <li>Le poisson doit √™tre <strong>en haut √† gauche</strong></li>
                    <li>La "bouche" du poisson (le coin jaune isol√©) doit pointer vers toi</li>
                    <li>Le "corps" du poisson (la ligne jaune) doit √™tre sur la gauche</li>
                </ol>
            </div>
            <div class="col-md-4 text-center">
                <div id="cube-fish-positioned" class="cube-case"></div>
                <p class="mt-2"><small>Position correcte</small></p>
            </div>
        </div>

        <div class="alert alert-warning">
            <strong>‚ö†Ô∏è Si tu ne vois PAS de poisson :</strong>
            <p class="mb-0 mt-2">
                Fais l'algorithme n'importe comment - un poisson va appara√Ætre! 
                Ensuite, oriente-le correctement et refais l'algorithme.
            </p>
        </div>
    </div>

    <!-- 3 sunes away -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üìä Les motifs suivants neccesite faire le sune 3 fois.</h3>

        <div class="row mt-3">
            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>OLL Superman</h5>
                    <div id="cube-superman" class="cube-case"></div>
                    <p class="mt-2"><small>Fais l'algorithme 1-3 fois pour voir un poisson</small></p>
                </div>
            </div>

            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>OLL Chameleon</h5>
                    <div id="cube-chameleon" class="cube-case"></div>
                    <p class="mt-2"><small>C'est un poisson! Oriente et applique</small></p>
                </div>
            </div>

            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>OLL Bowtie</h5>
                    <div id="cube-bowtie" class="cube-case"></div>
                    <p class="mt-2"><small>C'est aussi un poisson! Oriente et applique</small></p>
                </div>
            </div>
        </div>

        <div class="alert alert-success mt-3">
            <strong>‚úÖ Apr√®s avoir ex√©cut√© l'algorithme une fois, tu devrais voir un des motifs suivants</strong> 
            Parfait! Tu peux passer √† l'√©tape suivante!
        </div>
    </div>

    <!-- 2 sunes away -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üìä Les motifs suivant neccesite faire l'algorithme sune fois </h3>

        <div class="row mt-3">
            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>OLL Pi</h5>
                    <div id="cube-pi" class="cube-case"></div>
                    <p class="mt-2"><small>Ce n'est pas un poisson! Oriente et applique.</p>
                    <p>Il deviendra le bon poisson.</small></p>                </div>
            </div>

            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>OLL Double Sune</h5>
                    <div id="cube-doublesune" class="cube-case"></div>
                    <p class="mt-2"><small>Ce n'est pas un poisson! Oriente et applique.</p>
                    <p>Il deviendra le bon poisson.</small></p>
                </div>
            </div>

            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>OLL AntiSune</h5>
                    <div id="cube-antisune" class="cube-case"></div>
                    <p class="mt-2"><small>C'est le mauvais poisson.  Oriente et applique</small></p>
                    <p>Il deviendra le bon poisson.</small></p>
                </div>
            </div>
        </div>

        <div class="alert alert-success mt-3">
            <strong>‚úÖ Apr√®s avoir exc√©cut√© le sune une 2e fois tu devrais voir le sune :</strong> 
            Parfait! Tu peux passer √† l'√©tape suivante!
        </div>
    </div>

    <!-- 1 sunes away -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üìä Le motif suivant n√©ccesite faire le sune une derni√®re fois </h3>

        <div class="row mt-3">
            
            <div class="col-md-4 text-center mb-3">
                <div class="border rounded p-3 bg-light">
                    <h5>OLL Sune</h5>
                    <div id="cube-sune" class="cube-case"></div>
                    <p class="mt-2"><small>C'est le bon poisson! Oriente et applique</small></p>
                </div>
            </div>
        </div>

        <div class="alert alert-success mt-3">
            <strong>‚úÖ Si tous les coins sont d√©j√† jaunes :</strong> 
            Parfait! Tu peux passer √† l'√©tape suivante!
        </div>
    </div>



    <!-- Section Processus complet -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üìã Processus complet</h3>
        <ol>
            <li class="mb-2">
                <strong>Regarde la face du haut</strong> : Compte combien de coins sont d√©j√† jaunes
            </li>
            <li class="mb-2">
                <strong>Cherche le poisson</strong> : 
                <ul>
                    <li>Si tu vois un poisson ‚Üí Passe √† l'√©tape 3</li>
                    <li>Si tu ne vois pas de poisson ‚Üí Fais l'algorithme dans n'importe quelle orientation</li>
                </ul>
            </li>
            <li class="mb-2">
                <strong>Oriente le poisson</strong> : En haut √† gauche, bouche vers toi
            </li>
            <li class="mb-2">
                <strong>Fais l'algorithme</strong> : <code>R U R' U R U2 R'</code>
            </li>
            <li class="mb-2">
                <strong>V√©rifie le r√©sultat</strong> : 
                <ul>
                    <li>Face jaune compl√®te ‚Üí Bravo! Passe √† l'√©tape suivante</li>
                    <li>Pas encore compl√®te ‚Üí Retourne √† l'√©tape 1</li>
                </ul>
            </li>
        </ol>

        <div class="alert alert-info mt-3 mb-0">
            <strong>üí° Combien de fois ?</strong>
            <p class="mb-0">Tu devras faire l'algorithme entre 1 et 5 fois. C'est normal! Sois patient.</p>
        </div>
    </div>

    <!-- Section Conseils -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üí° Conseils utiles</h3>
        <ul class="mt-3">
            <li>
                <strong>L'orientation du poisson est essentielle!</strong> Si le poisson n'est pas 
                en haut √† gauche avec la bouche vers toi, √ßa ne marchera pas correctement.
            </li>
            <li>
                <strong>Ne te d√©courage pas si √ßa prend plusieurs r√©p√©titions.</strong> 
                C'est normal de devoir faire l'algorithme 3, 4 ou m√™me 5 fois!
            </li>
            <li>
                <strong>Pratique R U R' U R U2 R' jusqu'√† ce que ce soit fluide.</strong> 
                Plus tu es rapide, moins c'est frustrant de devoir le r√©p√©ter!
            </li>
            <li>
                <strong>Un truc pour se souvenir :</strong> C'est comme <code>R U R' U'</code> 
                mais avec U au lieu de U', et on ajoute <code>R U2 R'</code> √† la fin.
            </li>
            <li>
                Une fois toute la face jaune termin√©e, tu es √† <strong>75% du cube r√©solu</strong>! 
                Plus que 2 √©tapes! üéâ
            </li>
        </ul>
    </div>

    <!-- Bouton de navigation -->
    <div class="text-center">
        <a href="{% url 'francontcube:cubienewbie_yellow_cross' %}" class="btn btn-outline-primary">
            ‚Üê Retour : La croix jaune
        </a>
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-outline-secondary ms-2">
            Vue d'ensemble
        </a>
        <a href="{% url 'francontcube:cubienewbie_corner_permutation' %}" class="btn btn-success ms-2">
            √âtape suivante : Permutation des coins ‚Üí
        </a>
    </div>
</div>

<!-- Styles CSS pour les cubes -->
<style>
.cube-small svg {
    max-width: 275px;
    height: auto;
}

.move-icon { 
    width: 56px; 
    height: 75px; 
}

.cube-case svg {
    max-width: 200px;
    height: auto;
}

@media (max-width: 768px) {
    .cube-small svg {
        max-width: 200px;
    }
    
    .cube-case svg {
        max-width: 150px;
    }
}
</style>

<!-- Script d'initialisation de la page -->
<script type="module">
  import { renderCube } from "{% static 'cube/js/cube_renderer.js' %}";

  function mountCube(containerId, state) {
    const container = document.getElementById(containerId);
    container.innerHTML = ''; // Clear any existing content
    
    // If state is missing, show a placeholder
    if (!state) {
      container.innerHTML = `
        <div class="alert alert-secondary text-center py-4">
          <i class="bi bi-cube text-muted" style="font-size: 3rem;"></i>
          <p class="mb-0 mt-2 text-muted">Cube state not available</p>
          <small class="text-muted">Create the CubeState in your admin tool</small>
        </div>
      `;
      return;
    }
    
    const template = document.getElementById("cube-template");
    const clone = template.content.cloneNode(true);
    container.appendChild(clone);

    const svg = container.querySelector("svg");
    renderCube(svg, state);
  }

  document.addEventListener("DOMContentLoaded", () => {
    // Mount all cubes
    mountCube("cube-before", {{ before_state|safe }});
    mountCube("cube-goal", {{ goal_state|safe }});
    

    // 3 sune away
    mountCube("cube-superman", {{ yellow_superman_state|safe }});
    mountCube("cube-chameleon", {{ yellow_chameleon_state|safe }});
    mountCube("cube-bowtie", {{ yellow_bowtie_state|safe }}); // Same as left, just showing position
    

    // 2 sune away
    mountCube("cube-antisune", {{ yellow_antisune_state|safe }});
    mountCube("cube-doublesune", {{ yellow_doublesune_state|safe }});
    mountCube("cube-pi", {{ yellow_pi_state|safe }}); // Same as left, just showing position
    
    // 1 sune away
    mountCube("cube-sune", {{ yellow_sune_state|safe }});
  });
</script>

{% endblock %}
{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}DerniÃ¨re Ã‰tape! â€” Francontcube{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Titre principal -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            ğŸ‰ DerniÃ¨re Ã‰tape : <span class="brand-green">Place les derniÃ¨res piÃ¨ces!</span>
        </h1>
        <p class="lead text-muted">
            Tu y es presque! Une derniÃ¨re Ã©tape et ton cube sera rÃ©solu!
        </p>
    </div>

    <!-- Charger le template SVG (cachÃ©) -->
    {% include "cube/partials/_cube_svg.html" %}

    <!-- Section Objectif -->
 <!-- C'est quoi le but? -->
 <div class="card border-success border-3 shadow-sm mb-4">
    <div class="card-body text-center p-5">
        <h2 class="mb-4">ğŸ¯ C'est quoi le but?</h2>
        <div class="d-flex justify-content-center mb-3">
            <div id="cube-goal"></div>
        </div>
        <h4 class="brand-green">Mettre chaque arÃªtes Ã  la bonne place!</h4>
        <p class="lead mb-0">L'arÃªte et les coins doivent avoir la mÃªme couleur. ğŸ¨</p>

    </div>
</div>

        <div class="alert alert-success text-center mt-3">
            <h5>âœ… Ton cube est dÃ©jÃ  rÃ©solu?</h5>
            <p class="mb-0"><strong>BRAVO! ğŸ‰</strong> Tu as fini! Continue de pratiquer pour devenir plus rapide!</p>
        </div>
    </div>

    <!-- Section : Trouve les "phares" -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ”¦ Ã‰tape 1 : Trouve la ligne!</h3>
        
        <div class="alert alert-info">
            <h5>ğŸ’¡ Place l'arÃªte et les deux coins de la mÃªme couleur en <strong>arriÃ¨re</strong>?</h5>
        </div>

        <div class="row mt-3">
            <div class="col-md-6 mb-3">
                <div class="border rounded p-3 bg-light text-center">
                    <h5 class="text-success">âœ… J'ai une ligne en arriÃ¨re</h5>
                    <div id="cube-one-good-edge" class="cube-small"></div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="border rounded p-3 bg-light text-center">
                    <h5 class="text-warning">âš ï¸ Pas de ligne</h5>
                    <div id="cube-no-good-edge" class="cube-small"></div>
                    <p class="mb-0"><small>Fais l'algorithme  1 fois et la ligne devrait apparaÃ®tre</small></p>
                </div>
            </div>
        </div>

        <div class="alert alert-warning">
            <strong>âš ï¸ Important:</strong> Ne regarde PAS le dessus jaune! Regarde les <strong>cÃ´tÃ©s</strong> du cube! ğŸ‘€
        </div>
    </div>

    <!-- Section : L'algorithme magique -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">âœ¨ Ã‰tape 2 : L'algorithme magique</h3>
        
        <p class="lead text-center">Voici la formule magique pour finir ton cube!</p>

        <div class="text-center p-4 bg-light rounded border border-success border-3 mb-3">
            <div class="d-flex justify-content-center align-items-center gap-2 my-2 flex-wrap">
                <svg class="move-icon"><use href="#R"/></svg>
                <svg class="move-icon"><use href="#U-prime"/></svg>
                <svg class="move-icon"><use href="#R"/></svg>
                <svg class="move-icon"><use href="#U"/></svg>
                <svg class="move-icon"><use href="#R"/></svg>
                <svg class="move-icon"><use href="#U"/></svg>
                <svg class="move-icon"><use href="#R"/></svg>
                <svg class="move-icon"><use href="#U-prime"/></svg>
                <svg class="move-icon"><use href="#R-prime"/></svg>
                <svg class="move-icon"><use href="#U-prime"/></svg>
                <svg class="move-icon"><use href="#R2"/></svg>


        <div class="alert alert-success">
            <h5>ğŸ® Astuce de pro:</h5>
            <ul class="mb-0">
                <li>Prends ton temps - c'est un algorithme un peu long</li>
                <li>Il y a beaucoup de <strong>R U</strong> - c'est normal!</li>
                <li>Tu devras peut-Ãªtre le faire <strong>2 fois</strong></li>
            </ul>
        </div>
    </div>

    <!-- Section : Comment faire -->
    <div class="card p-4 mb-4 bg-light">
        <h3 class="brand-green">ğŸ“ Les Ã©tapes faciles</h3>
        
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h4>1ï¸âƒ£ Si tu as une ligne!</h4>
                        <ul>
                            <li>Mets la ligne <strong>derriÃ¨re</strong> (face arriÃ¨re)</li>
                            <li>Fais l'algorithme magique</li>
                            <li>Ton cube pourrait Ãªtre rÃ©solu! ğŸ‰</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h4>2ï¸âƒ£ Si tu n'as pas de ligne âš ï¸</h4>
                        <ul>
                            <li>Fais l'algorithme magique <strong>une fois</strong></li>
                            <li>Maintenant tu devrais avoir une ligne!</li>
                            <li>Retourne Ã  l'Ã©tape 1 ğŸ‘†</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section FÃ©licitations -->
    <div class="card p-4 mb-4 border-success border-3 bg-gradient" style="background: linear-gradient(135deg, #f8f9fa 0%, #e3f2e1 100%);">
        <div class="text-center">
            <h2 class="display-4">ğŸŠ TU AS RÃ‰USSI! ğŸŠ</h2>
            <p class="lead">Tu as rÃ©solu le Rubik's Cube!</p>
            
            <div class="row mt-4">
                <div class="col-md-4 mb-3">
                    <div class="card bg-white">
                        <div class="card-body">
                            <h1 class="display-1">ğŸ†</h1>
                            <h5>Champion!</h5>
                            <p class="small mb-0">Tu es maintenant un solveur de cube!</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card bg-white">
                        <div class="card-body">
                            <h1 class="display-1">âš¡</h1>
                            <h5>Continue!</h5>
                            <p class="small mb-0">Plus tu pratiques, plus tu seras rapide!</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card bg-white">
                        <div class="card-body">
                            <h1 class="display-1">ğŸŒŸ</h1>
                            <h5>Partage!</h5>
                            <p class="small mb-0">Montre Ã  tes amis ce que tu sais faire!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Boutons de navigation -->
    <div class="text-center">
        <a href="{% url 'francontcube:cubienewbie_corner_permutation' %}" class="btn btn-outline-primary btn-lg">
            â† Ã‰tape prÃ©cÃ©dente
        </a>
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-success btn-lg ms-2">
            Voir toutes les Ã©tapes
        </a>
    </div>
</div>

<!-- Styles CSS -->
<style>
.cube-small svg {
    max-width: 275px;
    height: auto;
}

.move-icon { 
    width: 56px; 
    height: 75px; 
}

@media (max-width: 768px) {
    .cube-small svg {
        max-width: 200px;
    }
    
    .move-icon {
        width: 48px;
        height: 64px;
    }
}
</style>

<!-- Script d'initialisation -->
<script type="module">
  import { renderCube } from "{% static 'cube/js/cube_renderer.js' %}";

  function mountCube(containerId, state) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    if (!state) {
      container.innerHTML = `
        <div class="alert alert-secondary text-center py-4">
          <i class="bi bi-cube text-muted" style="font-size: 3rem;"></i>
          <p class="mb-0 mt-2 text-muted">Cube non disponible</p>
        </div>
      `;
      return;
    }
    
    const template = document.getElementById("cube-template");
    const clone = template.content.cloneNode(true);
    container.appendChild(clone);

    const svg = container.querySelector("svg");
    renderCube(svg, state);
  }

  document.addEventListener("DOMContentLoaded", () => {
    mountCube("cube-goal", {{ goal_state|safe }});
    mountCube("cube-no-good-edge", {{ no_good_edge_state|safe }});
    mountCube("cube-one-good-edge", {{ one_good_edge_state|safe }});
  });
</script>

{% endblock %}
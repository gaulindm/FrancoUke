{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}Permutation des arÃªtes â€” Francontcube{% endblock %}

{% block content %}

<div class="container py-5">

    <!-- Titre principal -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            Ã‰tape 7 : <span class="brand-green">Permutation des arÃªtes</span>
        </h1>
        <p class="lead text-muted">
            La derniÃ¨re Ã©tape ! Place les 4 arÃªtes de la face jaune pour rÃ©soudre complÃ¨tement le cube.
        </p>
        <div class="row mt-3">
            <div class="col-md-6 text-center mb-3">
                <h5>Avant : Presque fini</h5>
                <div id="cube-container-before" class="cube-small"></div>
                <p><small class="text-muted">Tous les coins sont bien placÃ©s, mais certaines arÃªtes peuvent Ãªtre mal positionnÃ©es</small></p>
            </div>
            <div class="col-md-6 text-center mb-3">
                <h5>AprÃ¨s : CUBE RÃ‰SOLU ! ğŸ‰</h5>
                <div id="cube-container-goal" class="cube-small"></div>
                <p><small class="text-muted">Toutes les piÃ¨ces sont Ã  leur place - fÃ©licitations!</small></p>
            </div>
        </div>
    </div>

    <!-- Section Objectif -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ¯ Objectif</h3>
        <p>
            Ã€ ce stade, ton cube est presque rÃ©solu ! <strong>Tous les coins sont dÃ©jÃ  bien placÃ©s</strong>, 
            il ne reste plus qu'Ã  positionner correctement les 4 arÃªtes de la derniÃ¨re face.
        </p>
        <p>
            Une arÃªte est "bien placÃ©e" quand ses 2 couleurs correspondent aux 2 centres adjacents. 
            Par exemple, une arÃªte jaune-rouge doit se trouver entre la face jaune et la face rouge.
        </p>
        <div class="alert alert-success mt-3">
            <strong>ğŸŠ C'est la derniÃ¨re Ã©tape !</strong> 
            Une fois les arÃªtes en place, ton Rubik's Cube sera complÃ¨tement rÃ©solu !
        </div>
    </div>

    <!-- Section Identification -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ” Ã‰tape 1 : Compter les arÃªtes bien placÃ©es</h3>
        <p>Regarde ton cube et identifie combien d'arÃªtes sont dÃ©jÃ  au bon endroit :</p>

        <div class="row mt-3">
            <div class="col-md-3 mb-3">
                <div class="border rounded p-3 text-center bg-light">
                    <h5 class="text-success">âœ… 4 arÃªtes</h5>
                    <p class="mb-0"><strong>FÃ©licitations !</strong></p>
                    <p class="small text-muted">Le cube est rÃ©solu !</p>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="border rounded p-3 text-center bg-light">
                    <h5 class="text-primary">1 arÃªte</h5>
                    <p class="mb-0"><strong>Cas standard</strong></p>
                    <p class="small text-muted">Place-la derriÃ¨re et applique l'algorithme</p>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="border rounded p-3 text-center bg-light">
                    <h5 class="text-warning">0 arÃªte</h5>
                    <p class="mb-0"><strong>Applique une fois</strong></p>
                    <p class="small text-muted">Au moins une arÃªte sera bien placÃ©e aprÃ¨s</p>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="border rounded p-3 text-center bg-light">
                    <h5 class="text-danger">2 arÃªtes opposÃ©es</h5>
                    <p class="mb-0"><strong>Cas spÃ©cial</strong></p>
                    <p class="small text-muted">Applique 2 fois l'algorithme</p>
                </div>
            </div>
        </div>

        <div class="alert alert-info mt-3">
            <strong>ğŸ’¡ Astuce :</strong> Tourne seulement la face jaune (U) pour vÃ©rifier si certaines arÃªtes 
            peuvent Ãªtre bien placÃ©es sans changer leur position. Ne touche PAS aux autres faces pendant la vÃ©rification !
        </div>
    </div>

    <!-- Section Algorithme -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ”„ Ã‰tape 2 : L'algorithme de permutation des arÃªtes</h3>

        <div class="border rounded p-4 bg-light">
            <h5 class="text-center mb-3">Algorithme principal</h5>
            
            <!-- Algorithm visualization -->
            <div class="text-center p-4 bg-white rounded border border-success border-3 mb-3">
                <div class="d-flex justify-content-center align-items-center gap-2 my-2 flex-wrap">
                    <svg class="move-icon"><use href="#R"/></svg>
                    <svg class="move-icon"><use href="#U-prime"/></svg>
                    <svg class="move-icon"><use href="#R"/></svg>
                    <svg class="move-icon"><use href="#U"/></svg>
                    <svg class="move-icon"><use href="#R"/></svg>
                    <svg class="move-icon"><use href="#U"/></svg>
                    <svg class="move-icon"><use href="#R"/></svg>
                    <svg class="move-icon"><use href="#U-prime"/></svg>
                    <svg class="move-icon"><use href="#R-prime"/></svg>
                    <svg class="move-icon"><use href="#U-prime"/></svg>
                    <svg class="move-icon"><use href="#R2"/></svg>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h6>ğŸ“‹ DÃ©composition :</h6>
                    <ul>
                        <li><code>R</code> = Droite (sens horaire)</li>
                        <li><code>U'</code> = Haut (sens anti-horaire)</li>
                        <li><code>R</code> = Droite (sens horaire)</li>
                        <li><code>U</code> = Haut (sens horaire)</li>
                        <li><code>R</code> = Droite (sens horaire)</li>
                        <li><code>U</code> = Haut (sens horaire)</li>
                        <li><code>R</code> = Droite (sens horaire)</li>
                        <li><code>U'</code> = Haut (sens anti-horaire)</li>
                        <li><code>R'</code> = Droite (sens anti-horaire)</li>
                        <li><code>U'</code> = Haut (sens anti-horaire)</li>
                        <li><code>R2</code> = Droite (180Â°, deux fois)</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <div id="cube-algo-demo" class="text-center"></div>
                    <p class="text-center mt-2"><small>Cet algorithme fait tourner 3 arÃªtes dans le sens horaire</small></p>
                    
                    <div class="alert alert-warning mt-3 p-2">
                        <strong>âš ï¸ Attention :</strong> Cet algorithme est long (11 mouvements). Prends ton temps et vÃ©rifie chaque mouvement !
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section MÃ©thode pas Ã  pas -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ“ MÃ©thode pas Ã  pas selon ton cas</h3>

        <!-- Cas 1: Une arÃªte bien placÃ©e -->
        <div class="border rounded p-3 mb-3 bg-light">
            <h5 class="text-primary">âœ… Cas 1 : Tu as UNE arÃªte bien placÃ©e</h5>
            <div class="row">
                <div class="col-md-3 text-center">
                    <div id="cube-case-1"></div>
                </div>
                <div class="col-md-9">
                    <ol>
                        <li class="mb-2">
                            <strong>Positionne le cube :</strong> Tourne le cube entier (pas seulement une face !) 
                            pour que l'arÃªte bien placÃ©e soit <strong>derriÃ¨re</strong> (entre les faces jaune et arriÃ¨re).
                        </li>
                        <li class="mb-2">
                            <strong>Applique l'algorithme :</strong> Fais <code>R U' R U R U R U' R' U' R2</code> une seule fois.
                        </li>
                        <li class="mb-2">
                            <strong>VÃ©rifie :</strong> Les 4 arÃªtes devraient maintenant Ãªtre bien placÃ©es. 
                            Si ce n'est pas le cas, vÃ©rifie que l'Ã©tape 6 (coins) Ã©tait bien complÃ©tÃ©e.
                        </li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Cas 2: Aucune arÃªte bien placÃ©e -->
        <div class="border rounded p-3 mb-3 bg-light">
            <h5 class="text-warning">âš ï¸ Cas 2 : Tu as AUCUNE arÃªte bien placÃ©e</h5>
            <div class="row">
                <div class="col-md-3 text-center">
                    <div id="cube-case-2"></div>
                </div>
                <div class="col-md-9">
                    <ol>
                        <li class="mb-2">
                            <strong>Applique l'algorithme :</strong> Peu importe l'orientation du cube, 
                            fais l'algorithme une fois.
                        </li>
                        <li class="mb-2">
                            <strong>Cherche l'arÃªte bien placÃ©e :</strong> Maintenant, au moins une arÃªte sera au bon endroit. 
                            Trouve-la en tournant seulement la face U ou en tournant le cube entier.
                        </li>
                        <li class="mb-2">
                            <strong>Repositionne et recommence :</strong> Mets l'arÃªte bien placÃ©e derriÃ¨re 
                            et applique l'algorithme une nouvelle fois (â†’ Cas 1).
                        </li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Cas 3: Deux arÃªtes opposÃ©es -->
        <div class="border rounded p-3 bg-light">
            <h5 class="text-danger">ğŸ”„ Cas 3 : Tu as DEUX arÃªtes opposÃ©es bien placÃ©es</h5>
            <div class="row">
                <div class="col-md-3 text-center">
                    <div id="cube-case-3"></div>
                </div>
                <div class="col-md-9">
                    <ol>
                        <li class="mb-2">
                            <strong>VÃ©rifie bien :</strong> Les deux arÃªtes doivent Ãªtre exactement opposÃ©es 
                            (face avant/arriÃ¨re OU gauche/droite), pas adjacentes.
                        </li>
                        <li class="mb-2">
                            <strong>PremiÃ¨re application :</strong> Place une arÃªte bien placÃ©e derriÃ¨re 
                            et applique l'algorithme une fois.
                        </li>
                        <li class="mb-2">
                            <strong>DeuxiÃ¨me application :</strong> Trouve la nouvelle arÃªte bien placÃ©e, 
                            mets-la derriÃ¨re, et applique l'algorithme Ã  nouveau.
                        </li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Section Conseils -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">ğŸ’¡ Conseils pour rÃ©ussir</h3>
        <ul>
            <li class="mb-2">
                <strong>L'algorithme est long :</strong> 
                Prends ton temps ! Il vaut mieux aller lentement et ne pas se tromper que de devoir tout recommencer.
            </li>
            <li class="mb-2">
                <strong>RÃ©pÃ¨te pour mÃ©moriser :</strong> 
                Cet algorithme commence et finit par R. Au milieu, il y a beaucoup de U et U'. 
                Le pattern est : R-U'-R-U-R-U-R-U'-R'-U'-R2
            </li>
            <li class="mb-2">
                <strong>"DerriÃ¨re", c'est oÃ¹ ?</strong> 
                Tiens le cube avec la face jaune vers le haut. L'arÃªte "derriÃ¨re" est celle 
                qui est la plus Ã©loignÃ©e de toi, entre la face jaune et la face arriÃ¨re.
            </li>
            <li class="mb-2">
                <strong>Ã‡a ne marche pas :</strong> 
                Si aprÃ¨s 2 ou 3 applications l'algorithme ne rÃ©sout pas le cube, c'est probablement 
                que l'Ã©tape 6 (permutation des coins) n'Ã©tait pas bien complÃ©tÃ©e.
            </li>
        </ul>
    </div>

    <!-- Section FÃ©licitations -->
    <div class="card p-4 mb-4 border-success bg-light">
        <h3 class="brand-green text-center">ğŸ‰ FÃ©licitations !</h3>
        <p class="text-center lead mb-3">
            Si tu as rÃ©ussi cette Ã©tape, ton Rubik's Cube est maintenant <strong>complÃ¨tement rÃ©solu</strong> !
        </p>
        <div class="text-center">
            <p class="mb-2">Maintenant que tu maÃ®trises les bases, tu peux :</p>
            <ul class="list-unstyled">
                <li>âœ¨ <strong>Pratiquer</strong> pour devenir de plus en plus rapide</li>
                <li>ğŸ¯ <strong>MÃ©moriser</strong> tous les algorithmes pour ne plus rÃ©flÃ©chir</li>
                <li>ğŸš€ <strong>Apprendre</strong> des mÃ©thodes plus avancÃ©es comme la mÃ©thode CFOP</li>
                <li>ğŸ† <strong>DÃ©fier</strong> tes amis et chronomÃ¨tre tes temps</li>
            </ul>
        </div>
    </div>

    <!-- Navigation -->
    <div class="text-center mt-5">
        <a href="{% url 'francontcube:corner_permutation' %}" class="btn btn-outline-primary">
            â† Retour : Orienter les coins jaunes
        </a>
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-success ms-2">
            ğŸ  Retour Ã  la vue d'ensemble
        </a>

    </div>
</div>

<script src="{% static 'cube/js/cube.js' %}"></script>

<style>
.cube-small svg { 
    max-width: 275px; 
    height: auto; 
}

#cube-algo-demo svg,
#cube-case-1 svg, 
#cube-case-2 svg, 
#cube-case-3 svg { 
    max-width: 180px; 
    height: auto; 
}

.move-icon { 
    width: 56px; 
    height: 75px; 
}

@media (max-width: 768px) {
    .cube-small svg { 
        max-width: 200px; 
    }
    
    #cube-algo-demo svg,
    #cube-case-1 svg, 
    #cube-case-2 svg, 
    #cube-case-3 svg { 
        max-width: 120px; 
    }
    
    .move-icon { 
        width: 42px; 
        height: 56px; 
    }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
    // Cube BEFORE: All corners positioned, but edges may be wrong
    insertCubeInContainer('cube-container-before', setAlmostSolved, 'before');
    
    // Cube GOAL: Completely solved!
    insertCubeInContainer('cube-container-goal', setSolvedCube, 'goal');
    
    // Demo cube for algorithm
    insertCubeInContainer('cube-algo-demo', setEdgePermutationDemo, 'demo');
    
    // Case examples
    insertCubeInContainer('cube-case-1', setOneEdgeCorrect, 'case1');
    insertCubeInContainer('cube-case-2', setNoEdgeCorrect, 'case2');
    insertCubeInContainer('cube-case-3', setTwoOppositeEdges, 'case3');
});
</script>

{% endblock %}
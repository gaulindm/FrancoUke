{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}La deuxiÃ¨me couche â€” Francontcube{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Titre principal avec emoji -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            ğŸ§© Ã‰tape 4 : <span class="brand-green">La deuxiÃ¨me couche!</span>
        </h1>
        <p class="lead">
            Place 4 arÃªtes dans le milieu du cube
        </p>
    </div>

    <!-- Charger le template SVG (cachÃ©) -->
    {% include "cube/partials/_cube_svg.html" %}

    <!-- Warning for missing cube states -->
    {% if missing_slugs %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">âš ï¸ Missing Cube States</h4>
        <p>The following CubeState objects need to be created in the database:</p>
        <ul class="mb-0">
            {% for slug in missing_slugs %}
            <li><code>{{ slug }}</code></li>
            {% endfor %}
        </ul>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

  
    <!-- C'est quoi le but? -->
    <div class="card border-success border-3 shadow-sm mb-4">
        <div class="card-body text-center p-5">
            <h2 class="mb-4">ğŸ¯ C'est quoi le but?</h2>
            <div id="cube-goal" class="mb-3 d-flex justify-content-center"></div>
            <p><strong>2 couches complÃ¨tes!</strong> ğŸ‰</p>
        </div>
    </div>

<!-- Trouver la bonne arÃªte - SIMPLIFIÃ‰ -->
<div class="card border-info border-3 shadow-sm mb-4">
    <div class="card-body p-4">
        <h3 class="text-center mb-4">ğŸ” Cherche une arÃªte SANS jaune pour former un T Ã  l'envers sur le cÃ´tÃ© droit</h3>
        
        <div class="row justify-content-center">
            <div class="col-md-6 text-center mb-3">
                <div class="p-4 bg-light rounded">
                    <h4 class="text-danger mb-3">âŒ Mauvaise arÃªte</h4>
                    <p class="lead mb-3">A du jaune =<br><strong>Pas pour maintenant!</strong></p>
                    <div class="d-flex justify-content-center">
                        <div id="cube-edge-yellow"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-info text-center mt-4 mb-0">
            <strong>ğŸ’¡ Astuce:</strong> Cherche dans la couche du HAUT. Il y a 4 arÃªtes Ã  placer!
        </div>
    </div>
</div>

    <!-- Les 2 algorithmes -->
    <div class="card shadow-sm mb-4">
        <div class="card-body p-4">
            <h2 class="text-center mb-4">ğŸ® Les 2 cas possibles</h2>
            <p class="text-center lead mb-4">Regarde oÃ¹ la couleur du centre devant apparaÃ®t sur ton arÃªte</p>
            
            <!-- Cas 1: Couleur devant -->
            <div class="case-card p-4 mb-4 border border-3 border-success rounded">
                <div class="row align-items-center">
                    <div class="col-md-4 text-center mb-3">
                        <h4 class="text-success mb-3">Cas 1: L'arÃªte va en AVANT</h4>
                        <div id="cube-case-front" class="mb-3"></div>
                    </div>
                    <div class="col-md-8">
                        <div class="text-center p-4 bg-light rounded">
                            <h5 class="mb-3">Fais cet algorithme:</h5>
                            <div class="d-flex justify-content-center align-items-center gap-2 flex-wrap mb-3">
                                <svg class="move-icon"><use href="#R-prime"/></svg>
                                <svg class="move-icon"><use href="#U-prime"/></svg>
                                <svg class="move-icon"><use href="#R-prime"/></svg>
                                <svg class="move-icon"><use href="#U-prime"/></svg>
                                <svg class="move-icon"><use href="#R-prime"/></svg>
                                <svg class="move-icon"><use href="#U"/></svg>
                                <svg class="move-icon"><use href="#R"/></svg>
                                <svg class="move-icon"><use href="#U"/></svg>
                                <svg class="move-icon"><use href="#R"/></svg>
                                
                            </div>
                            <p class="text-success mb-0"><strong>L'arÃªte descend en avant! â†’</strong></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cas 2: Couleur Ã  droite -->
            <div class="case-card p-4 border border-3 border-primary rounded">
                <div class="row align-items-center">
                    <div class="col-md-4 text-center mb-3">
                        <h4 class="text-primary mb-3">Cas 2: L'arÃªte va Ã  l'ARRIÃˆRE</h4>
                        <div id="cube-case-back" class="mb-3"></div>
                    </div>
                    <div class="col-md-8">
                        <div class="text-center p-4 bg-light rounded">
                            <h5 class="mb-3">Fais cet algorithme:</h5>
                            <div class="d-flex justify-content-center align-items-center gap-2 flex-wrap mb-3">


                                <svg class="move-icon"><use href="#R"/></svg>
                                <svg class="move-icon"><use href="#U"/></svg>
                                <svg class="move-icon"><use href="#R"/></svg>
                                <svg class="move-icon"><use href="#U"/></svg>
                                <svg class="move-icon"><use href="#R"/></svg>
                                <svg class="move-icon"><use href="#U-prime"/></svg>
                                <svg class="move-icon"><use href="#R-prime"/></svg>
                                <svg class="move-icon"><use href="#U-prime"/></svg>
                                <svg class="move-icon"><use href="#R-prime"/></svg>
                            </div>
                            <p class="text-primary mb-0"><strong>L'arÃªte descend Ã  l'arriÃ¨re! â†</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comment faire - 3 Ã©tapes simples -->
    <div class="card border-warning border-2 shadow-sm mb-4">
        <div class="card-body p-4">
            <h3 class="text-center mb-4">ğŸ“ Comment faire? (3 Ã©tapes!)</h3>
            
            <div class="row">
                <div class="col-md-4 text-center mb-4">
                    <div class="display-1 text-primary">1ï¸âƒ£</div>
                    <h4 class="mt-3 brand-green">Trouve</h4>
                    <p class="lead">Cherche une arÃªte SANS jaune en haut</p>
                </div>
                
                <div class="col-md-4 text-center mb-4">
                    <div class="display-1 text-info">2ï¸âƒ£</div>
                    <h4 class="mt-3 brand-green">Positionne</h4>
                    <p class="lead">Forme un T en l'envers sur la face de droite</p>
                </div>
                
                <div class="col-md-4 text-center mb-4">
                    <div class="display-1 text-success">3ï¸âƒ£</div>
                    <h4 class="mt-3 brand-green">Choisis</h4>
                    <p class="lead">Cas 1 (AVANT) ou Cas 2 (ARRIÃˆRE)?</p>
                </div>
            </div>

            <div class="alert alert-success text-center mt-4 mb-0">
                <h5>ğŸ”„ RÃ©pÃ¨te pour les 4 arÃªtes!</h5>
                <div class="d-flex justify-content-center gap-3 mt-3 flex-wrap">
                    <span class="edge-progress">1ï¸âƒ£</span>
                    <span class="edge-progress">2ï¸âƒ£</span>
                    <span class="edge-progress">3ï¸âƒ£</span>
                    <span class="edge-progress">4ï¸âƒ£</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Cas spÃ©cial: ArÃªte coincÃ©e -->
    <div class="card border-danger border-2 shadow-sm mb-4">
        <div class="card-body p-4">
            <h3 class="text-center mb-4">âš ï¸ ArÃªte coincÃ©e dans le milieu?</h3>
            
            <div class="row align-items-center">
                <div class="col-md-4 text-center mb-3">
                    <div id="cube-edge-stuck" class="mb-3"></div>
                    <p><small>ArÃªte mal placÃ©e</small></p>
                </div>
                <div class="col-md-8">
                    <div class="p-4 bg-light rounded">
                        <h5 class="text-danger mb-3">Solution simple:</h5>
                        <ol class="mb-0">
                            <li class="mb-2">Mets n'importe quelle arÃªte au-dessus</li>
                            <li class="mb-2">Fais un des 2 algorithmes</li>
                            <li class="mb-0">L'arÃªte coincÃ©e sort en haut - maintenant tu peux la replacer!</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Encouragement final -->
    <div class="card bg-success text-white shadow-sm mb-4">
        <div class="card-body text-center p-5">
            <h2 class="mb-3">ğŸŒŸ Tu y es presque!</h2>
            <p class="lead mb-0">
                Ces algorithmes sont plus longs, mais avec de la pratique,<br>
                ils deviennent faciles! Continue - tu fais du super travail! ğŸ‰
            </p>
        </div>
    </div>

    <!-- Navigation -->
    <div class="d-flex justify-content-between flex-wrap gap-2">
        <a href="{% url 'francontcube:cubienewbie_bottom_corners' %}" class="btn btn-outline-primary btn-lg">
            â† Coins blancs
        </a>
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-outline-secondary btn-lg">
            ğŸ  Menu
        </a>
        <a href="{% url 'francontcube:cubienewbie_yellow_cross' %}" class="btn btn-success btn-lg">
            Croix jaune â†’
        </a>
    </div>
</div>

<!-- Styles CSS -->
<style>
/* Cubes */
#cube-before svg,
#cube-goal svg {
    max-width: 300px;
    height: auto;
}

#cube-case-front svg,
#cube-case-back svg {
    max-width: 200px;
    height: auto;
}

#cube-edge-yellow svg,
#cube-edge-stuck svg {
    max-width: 150px;
    height: auto;
}

/* IcÃ´nes de mouvements */
.move-icon {
    width: 50px;
    height: 67px;
}

/* Progress des arÃªtes */
.edge-progress {
    font-size: 2rem;
    display: inline-block;
    padding: 10px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    min-width: 50px;
}

/* Case cards */
.case-card {
    background: white;
    transition: transform 0.2s;
}

.case-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Animation */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-in {
    animation: slideIn 0.5s ease-out;
}

/* Effet hover */
.btn-lg:hover {
    transform: scale(1.02);
    transition: transform 0.2s;
}

@media (max-width: 768px) {
    #cube-before svg,
    #cube-goal svg {
        max-width: 250px;
    }
    
    #cube-case-front svg,
    #cube-case-back svg {
        max-width: 180px;
    }
    
    #cube-edge-yellow svg,
    #cube-edge-stuck svg {
        max-width: 120px;
    }
    
    .move-icon {
        width: 40px;
        height: 54px;
    }
    
    .btn-lg {
        font-size: 1rem;
    }
    
    .display-1 {
        font-size: 3rem;
    }
    
    .edge-progress {
        font-size: 1.5rem;
        min-width: 40px;
    }
}
</style>

<!-- Script JavaScript -->
<script type="module">
  import { renderCube } from "{% static 'cube/js/cube_renderer.js' %}";

  function mountCube(containerId, state) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    container.innerHTML = '';

    if (!state) {
      container.innerHTML = `
        <div class="alert alert-secondary text-center py-4">
          <i class="bi bi-cube text-muted" style="font-size: 3rem;"></i>
          <p class="mb-0 mt-2 text-muted">Cube non disponible</p>
        </div>
      `;
      return;
    }

    const template = document.getElementById("cube-template");
    const clone = template.content.cloneNode(true);
    container.appendChild(clone);

    const svg = container.querySelector("svg");
    renderCube(svg, state);
  }

  document.addEventListener("DOMContentLoaded", () => {
    mountCube("cube-goal", {{ goal_state|safe }});
    mountCube("cube-case-front", {{ case_front_state|safe }});
    mountCube("cube-case-back", {{ case_back_state|safe }});
    mountCube("cube-edge-yellow", {{ edge_yellow_state|safe }});
    mountCube("cube-edge-stuck", {{ edge_stuck_state|safe }});
  });
</script>

{% endblock %}
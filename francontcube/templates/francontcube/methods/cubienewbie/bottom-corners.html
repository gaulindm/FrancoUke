{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}Les coins blancs ‚Äî Francontcube{% endblock %}

{% block content %}

<div class="container py-5">

    <!-- Titre principal -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            √âtape 2 : <span class="brand-green">Les coins blancs</span>
        </h1>
        <p class="lead text-muted">
            Compl√©ter la premi√®re couche en pla√ßant les 4 coins blancs au bon endroit.
        </p>
    </div>

    <!-- Charger le template SVG (cach√©) -->
    {% include "cube/partials/_cube_svg.html" %}

    <!-- Warning for missing cube states (only shown if any are missing) -->
    {% if missing_slugs %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">‚ö†Ô∏è Missing Cube States</h4>
        <p>The following CubeState objects need to be created in the database:</p>
        <ul class="mb-0">
            {% for slug in missing_slugs %}
            <li><code>{{ slug }}</code></li>
            {% endfor %}
        </ul>
        <hr>
        <p class="mb-0 small">Use your cube state creation tool to add these. The page will display placeholders until they're created.</p>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <!-- Section Objectif -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üéØ Objectif</h3>
        <p>
            Placer les 4 coins blancs pour <strong>compl√©ter toute la face blanche du bas</strong>. 
            Chaque coin doit avoir ses 3 couleurs qui correspondent aux 3 centres voisins.
        </p>

        <div class="row mt-3">
            <div class="col-md-6 text-center mb-3">
                <h5>Avant : Croix blanche</h5>
                <div id="cube-before"></div>
                <p><small class="text-muted">4 ar√™tes blanches en place</small></p>
            </div>
            <div class="col-md-6 text-center mb-3">
                <h5>Apr√®s : Premi√®re couche compl√®te</h5>
                <div id="cube-goal" class="cube-small"></div>
                <p><small class="text-muted">4 coins blancs + 4 ar√™tes = couche compl√®te!</small></p>
            </div>
        </div>
    </div>

    <!-- Section Trouver le coin -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üîç √âtape 1 : Trouve le bon coin</h3>
        <p>
            Il y a <strong>4 coins blancs</strong> sur ton cube. Chaque coin a 3 couleurs (blanc + 2 autres).
        </p>
        
        <div class="alert alert-info">
            <strong>üí° Comment trouver le bon coin :</strong>
            <ol class="mb-0 mt-2">
                <li>Regarde ton cube - quelle face est devant toi? (exemple: vert)</li>
                <li>Regarde le centre de droite - quelle couleur? (exemple: orange)</li>
                <li>Cherche le coin qui a <strong>blanc + vert + orange</strong></li>
                <li>Ce coin va dans le coin <strong>en bas √† droite</strong> devant toi!</li>
            </ol>
        </div>

        <p class="mt-3">
            <strong>Astuce :</strong> Les coins sont soit dans la couche du haut (o√π tu vas les chercher), 
            soit d√©j√† dans la couche du bas (mais peut-√™tre mal orient√©s).
        </p>
    </div>
    <!-- Section Algorithmes -->
    <div class="card p-4 mb-4">
        <div class="card p-4 mb-4">
            <h3 class="brand-green">üîÑ √âtape 2 : Ins√®re le coin (un seul algorithme)</h3>
        
            <p>
                Bonne nouvelle üéâ  
                <strong>Il n‚Äôy a qu‚Äôun seul algorithme √† apprendre pour placer tous les coins blancs.</strong>
            </p>
        
            <div class="alert alert-success text-center">
                <h4 class="mb-3">Algorithme unique</h4>
        
                <div class="d-flex justify-content-center align-items-center gap-2 my-2 flex-wrap">
                    <svg class="move-icon"><use href="#R"/></svg>
                    <svg class="move-icon"><use href="#U"/></svg>
                    <svg class="move-icon"><use href="#R-prime"/></svg>
                    <svg class="move-icon"><use href="#U-prime"/></svg>
                </div>
        
                <p class="mb-0 mt-2">
                    üëâ <strong>R√©p√®te cet algorithme jusqu‚Äô√† 5 fois</strong><br>
                    jusqu‚Äô√† ce que le coin soit bien plac√©.
                </p>
            </div>
        </div>
        <!-- Cas 1: Face vers la droite -->
        <div class="border rounded p-3 mb-3 bg-light">
            <h5 class="text-success">‚úÖ Cas 1 : L'ar√™te va vers l'avant</h5>
            <p>La couleur qui correspond au centre de devant est <strong>sur la face avant</strong>.</p>
            
            <div class="row align-items-center">
                <div class="col-md-4 text-center">
                    <div id="cube-case-1" class="cube-case"></div>
                    <p class="mt-2"><small>Position de d√©part</small></p>
                    </div>
                    <div class="col-md-8">
                        <div class="text-center p-3 bg-white rounded border border-success border-2">
                            <div class="d-flex justify-content-center align-items-center gap-2 my-2 flex-wrap">
                                <svg class="move-icon"><use href="#R"/></svg>
                                <svg class="move-icon"><use href="#U"/></svg>
                                <svg class="move-icon"><use href="#R-prime"/></svg>
                                <svg class="move-icon"><use href="#U-prime"/></svg>
                        </div>
                        <p class="mb-0 mt-2">
                            üëâ <strong>Execute cet algorithme seulement une fois</strong><br>
                        </p>                    
                    </div>
                </div>
            </div>
        </div>

        <!-- Cas 2: Face vers le haut -->
        <div class="border rounded p-3 mb-3 bg-light">
            <h5 class="text-primary">‚úÖ Cas 2 : L'ar√™te va vers le haut</h5>
            <p>La couleur qui correspond au centre de devant est <strong>sur la face du haut</strong>.</p>
            
            <div class="row align-items-center">
                <div class="col-md-4 text-center">
                    <div id="cube-case-3" class="cube-case"></div>
                    <p class="mt-2"><small>Position de d√©part</small></p>
                </div>
                <div class="col-md-8">
                    <div class="text-center p-3 bg-white rounded border border-success border-2">
                        <div class="d-flex justify-content-center align-items-center gap-2 my-2 flex-wrap">
                            <svg class="move-icon"><use href="#R"/></svg>
                            <svg class="move-icon"><use href="#U"/></svg>
                            <svg class="move-icon"><use href="#R-prime"/></svg>
                            <svg class="move-icon"><use href="#U-prime"/></svg>
                    </div>
                    <p class="mb-0 mt-2">
                        üëâ <strong>Execute cet algorithme 3 fois</strong><br>
                    </p>                    
                </div>
                </div>
            </div>
        </div>     
        <!-- Cas 2: Ar√™te va en arriere -->
        <div class="border rounded p-3 mb-3 bg-light">
            <h5 class="text-primary">‚úÖ Cas 3 : La face blanche pointe vers l'avant</h5>
            <p>La couleur qui correspond au centre de devant est <strong>sur la face de droite</strong>.</p>
            
            <div class="row align-items-center">
                <div class="col-md-4 text-center">
                    <div id="cube-case-2" class="cube-case"></div>
                    <p class="mt-2"><small>Position de d√©part</small></p>
                </div>
                <div class="col-md-8">
                    <div class="text-center p-3 bg-white rounded border border-success border-2">
                        <div class="d-flex justify-content-center align-items-center gap-2 my-2 flex-wrap">
                            <svg class="move-icon"><use href="#R"/></svg>
                            <svg class="move-icon"><use href="#U"/></svg>
                            <svg class="move-icon"><use href="#R-prime"/></svg>
                            <svg class="move-icon"><use href="#U-prime"/></svg>
                    </div>
                    <p class="mb-0 mt-2">
                        üëâ <strong>Execute cet algorithme 5 fois</strong><br>
                    </p>                    
                </div>
                </div>
            </div>
        </div>
    
    




    <div class="mt-4">
        <h5 class="brand-green">üìç Position de travail (tr√®s important)</h5>
        <ul>
            <li>Le blanc est toujours <strong>en bas</strong></li>
            <li>Le coin √† travailler est plac√© <strong>en haut √† droite devant toi</strong></li>
            <li>Peu importe o√π est le blanc sur le coin</li>
        </ul>
    </div>

</div>


    <!-- Section Technique -->
    <div class="card p-4 mb-4 border-success">
        <h3 class="brand-green">‚úã Technique de prise (IMPORTANT!)</h3>
        <div class="alert alert-success">
            <strong>Pour l'algorithme R U R' U' :</strong>
            <ul class="mb-0 mt-2">
                <li>Tiens le cube <strong>fermement avec ta main gauche</strong></li>
                <li>Ta main droite fait <strong>tous les mouvements</strong> (R, U, R')</li>
                <li>Ton pouce droit fait R et R'</li>
                <li>Ton index droit fait U</li>
                <li>Ton index gauche fait U'</li>
                <li><strong>Pratique lentement d'abord, puis acc√©l√®re!</strong></li>
            </ul>
        </div>
    </div>

    <!-- Section Processus complet -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üìã Processus complet pour chaque coin blanc</h3>

        <ol>
            <li class="mb-2">
                <strong>Trouve le bon coin</strong><br>
                Regarde les deux centres devant et √† droite, puis cherche le coin avec ces couleurs + blanc.
            </li>

            <li class="mb-2">
                <strong>Am√®ne le coin dans la couche du haut</strong><br>
                S‚Äôil est d√©j√† en bas mais mal plac√©, fais <code>R U R' U'</code> pour le sortir.
            </li>

            <li class="mb-2">
                <strong>Place le coin au-dessus de sa position</strong><br>
                Tourne seulement la face du haut (<code>U</code>) jusqu‚Äô√† ce que le coin soit au bon endroit.
            </li>

            <li class="mb-2">
                <strong>Applique l‚Äôalgorithme</strong><br>
                Fais <code>R U R' U'</code> lentement.
                R√©p√®te jusqu‚Äô√† ce que le coin soit correctement plac√©.
            </li>

            <li class="mb-2">
                <strong>Tourne le cube entier</strong><br>
                Garde le blanc en bas et recommence pour le coin suivant.
            </li>
        </ol>
    </div>


    <!-- Section Conseils -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üí° Conseils utiles</h3>
        <ul class="mt-3">

            <li>
                <strong>Pratique R U R' U' jusqu'√† ce que ce soit automatique.</strong> 
                C'est l'algorithme le plus important du cube!
            </li>

            <li>
                Une fois les 4 coins plac√©s, <strong>toute la face blanche est compl√®te</strong> - 
                f√©licitations, c'est le tiers du cube! üéâ
            </li>
        </ul>
    </div>

    <!-- Bouton de navigation -->
    <div class="text-center">
        <a href="{% url 'francontcube:white_cross' %}" class="btn btn-outline-primary">
            ‚Üê Retour : La croix blanche
        </a>
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-outline-secondary ms-2">
            Vue d'ensemble
        </a>
        <a href="{% url 'francontcube:second_layer' %}" class="btn btn-success ms-2">
            √âtape suivante : La deuxi√®me couche ‚Üí
        </a>
    </div>
</div>

<!-- Styles CSS pour les cubes -->
<style>
.cube-small svg { 
    max-width: 275px; 
    height: auto; 
}

#cube-case-1 svg, 
#cube-case-2 svg, 
#cube-case-3 svg { 
    max-width: 200px; 
    height: auto; 
}

.move-icon { 
    width: 64px; 
    height: 86px; 
}

@media (max-width: 768px) {
    .cube-small svg { 
        max-width: 200px; 
    }
    
    #cube-case-1 svg, 
    #cube-case-2 svg, 
    #cube-case-3 svg { 
        max-width: 150px; 
    }
    
    .move-icon { 
        width: 48px; 
        height: 64px; 
    }
}
</style>

<!-- Script d'initialisation de la page -->
<script type="module">
  import { renderCube } from "{% static 'cube/js/cube_renderer.js' %}";

  function mountCube(containerId, state) {
    const container = document.getElementById(containerId);
    container.innerHTML = ''; // Clear any existing content
    
    // If state is missing, show a placeholder
    if (!state) {
      container.innerHTML = `
        <div class="alert alert-secondary text-center py-4">
          <i class="bi bi-cube text-muted" style="font-size: 3rem;"></i>
          <p class="mb-0 mt-2 text-muted">Cube state not available</p>
          <small class="text-muted">Create the CubeState in your admin tool</small>
        </div>
      `;
      return;
    }
    
    const template = document.getElementById("cube-template");
    const clone = template.content.cloneNode(true);
    container.appendChild(clone);

    const svg = container.querySelector("svg");
    renderCube(svg, state);
  }

  document.addEventListener("DOMContentLoaded", () => {
    // Mount all cubes
    mountCube("cube-before", {{ before_state|safe }});
    mountCube("cube-goal", {{ goal_state|safe }});
    
    // The 3 algorithm cases
    mountCube("cube-case-1", {{ case_1_state|safe }});
    mountCube("cube-case-2", {{ case_2_state|safe }});
    mountCube("cube-case-3", {{ case_3_state|safe }});
  });
</script>

{% endblock %}
{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}Les coins blancs ‚Äî Francontcube{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Titre principal avec emoji -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            üî≤ √âtape 3 : <span class="brand-green">Les coins blancs!</span>
        </h1>
        <p class="lead">
            Compl√®te toute la face blanche avec 4 coins
        </p>
    </div>

    <!-- Charger le template SVG (cach√©) -->
    {% include "cube/partials/_cube_svg.html" %}

    <!-- Warning for missing cube states -->
    {% if missing_slugs %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">‚ö†Ô∏è Missing Cube States</h4>
        <p>The following CubeState objects need to be created in the database:</p>
        <ul class="mb-0">
            {% for slug in missing_slugs %}
            <li><code>{{ slug }}</code></li>
            {% endfor %}
        </ul>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <!-- C'est quoi le but? -->
    <div class="card border-success border-3 shadow-sm mb-4">
        <div class="card-body text-center p-5">
            <h2 class="mb-4">üéØ C'est quoi le but?</h2>
            <div id="cube-goal" class="mb-3"></div>
            <h4 class="brand-green">Toute la face blanche doit √™tre compl√®te!</h4>
            <p class="lead mb-0">Croix blanche ‚úÖ + 4 coins blancs = Face compl√®te! üéâ</p>
        </div>
    </div>

    <!-- Le super algorithme magique - UNE SEULE FOIS -->
    <div class="card bg-gradient shadow-sm mb-4" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <div class="card-body text-center text-white p-5">
            <h2 class="mb-4">‚ú® L'algorithme magique pour TOUS les coins!</h2>
            
            <div class="p-4 bg-white bg-opacity-25 rounded-3 d-inline-block mb-4">
                <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap">
                    <svg class="move-icon-large"><use href="#R"/></svg>
                    <svg class="move-icon-large"><use href="#U"/></svg>
                    <svg class="move-icon-large"><use href="#R-prime"/></svg>
                    <svg class="move-icon-large"><use href="#U-prime"/></svg>
                </div>
            </div>
            
            
            <div class="alert alert-light text-dark">
                <h5 class="mb-3">üîë Le secret:</h5>
                <p class="lead mb-2"><strong>Main gauche tient le cube</strong></p>
                <p class="lead mb-0"><strong>Main droite fait tous les mouvements</strong></p>
            </div>
        </div>
    </div>

   <!-- Comment faire (simplifi√©) -->
   <div class="card border-primary border-2 shadow-sm mb-4">
    <div class="card-body p-4">
        <h3 class="text-center mb-4">üìù Les 3 √©tapes pour chacun des 4 coins</h3>
        
        <div class="row">
            <div class="col-md-4 text-center mb-4">
                <div class="display-1 text-primary">1Ô∏è‚É£</div>
                <h4 class="mt-3 brand-green">Trouve</h4>
                <p class="lead">Cherche le coin avec du blanc et les couleurs des centres AVANT et DROIT</p>
            </div>
            
            <div class="col-md-4 text-center mb-4">
                <div class="display-1 text-info">2Ô∏è‚É£</div>
                <h4 class="mt-3 brand-green">Positionne</h4>
                <p class="lead">Mets-le en haut √† droite devant toi</p>
            </div>
            
            <div class="col-md-4 text-center mb-4">
                <div class="display-1 text-success">3Ô∏è‚É£</div>
                <h4 class="mt-3 brand-green">R√©p√®te</h4>
                <p class="lead">Fais R U R' U' le bon nombre de fois</p>
            </div>
        </div>
    </div>
</div>
    <!-- Les 6 cas possibles en grille -->
    <div class="card shadow-sm mb-4">
        <div class="card-body p-4">
            <h2 class="text-center mb-4">üéÆ Les 6 situations possibles</h2>
            <p class="text-center lead mb-4">Trouve ta situation et suis l'instruction</p>
            
            <!-- Rang√©e 1: Coin en haut -->
            <div class="row mb-4">
                <div class="col-md-4 text-center mb-3">
                    <div class="case-card p-3 border rounded bg-light">
                        <div id="cube-case-1" class="mb-3"></div>
                        <div class="case-label bg-success text-white p-2 rounded">
                            Blanc ‚Üí droite : <strong>1 fois</strong>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-center mb-3">
                    <div class="case-card p-3 border rounded bg-light">
                        <div id="cube-case-2" class="mb-3"></div>
                        <div class="case-label bg-info text-white p-2 rounded">
                            Blanc ‚Üí haut : <strong>3 fois</strong>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-center mb-3">
                    <div class="case-card p-3 border rounded bg-light">
                        <div id="cube-case-3" class="mb-3"></div>
                        <div class="case-label bg-warning text-white p-2 rounded">
                            Blanc ‚Üí avant : <strong>5 fois </strong>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Rang√©e 2: Situations sp√©ciales -->
            <div class="row">
                <div class="col-md-4 text-center mb-3">
                    <div class="case-card p-3 border rounded bg-light">
                        <div id="cube-case-4" class="mb-3"></div>
                        <div class="case-label bg-danger text-white p-2 rounded">
                            <strong>Sors-le avec 1 fois et recommence</strong>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-center mb-3">
                    <div class="case-card p-3 border rounded bg-light">
                        <div id="cube-case-5" class="mb-3"></div>
                        <div class="case-label bg-primary text-white p-2 rounded">
                            <strong>2 mauvaises couleurs</strong>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-center mb-3">
                    <div class="case-card p-3 border rounded bg-light">
                        <div id="cube-case-6" class="mb-3"></div>
                        <div class="case-label bg-secondary text-white p-2 rounded">
                            <strong>1 mauvaise couleur</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

 

    <!-- Encouragement final -->
    <div class="card bg-success text-white shadow-sm mb-4">
        <div class="card-body text-center p-5">
            <h2 class="mb-3">üåü Tu peux le faire!</h2>
            <p class="lead mb-0">
                Un seul algorithme √† conna√Ætre: <strong>R U R' U'</strong><br>
                R√©p√®te-le pour chaque coin et ta face blanche sera compl√®te! üéâ
            </p>
        </div>
    </div>

    <!-- Navigation -->
    <div class="d-flex justify-content-between flex-wrap gap-2">
        <a href="{% url 'francontcube:cubienewbie_white_cross' %}" class="btn btn-outline-primary btn-lg">
            ‚Üê Croix blanche
        </a>
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-outline-secondary btn-lg">
            üè† Menu
        </a>
        <a href="{% url 'francontcube:cubienewbie_second_layer' %}" class="btn btn-success btn-lg">
            Deuxi√®me couche ‚Üí
        </a>
    </div>
</div>

<!-- Styles CSS -->
<style>
/* Cubes */
#cube-goal svg {
    max-width: 350px;
    height: auto;
}

/* Mini cubes dans la grille */
#cube-case-1 svg,
#cube-case-2 svg,
#cube-case-3 svg,
#cube-case-4 svg,
#cube-case-5 svg,
#cube-case-6 svg {
    max-width: 180px;
    height: auto;
}

/* Case cards */
.case-card {
    transition: transform 0.2s;
}

.case-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.case-label {
    font-size: 1.1rem;
    font-weight: bold;
}

/* Ic√¥nes de mouvements - SEULEMENT dans la carte rose */
.move-icon-large {
    width: 80px;
    height: 107px;
}

/* Progress des coins */
.corner-progress {
    font-size: 2rem;
    display: inline-block;
    padding: 10px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    min-width: 50px;
}

/* Step number circles */
.step-number-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
    flex-shrink: 0;
}

/* Animation */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-in {
    animation: slideIn 0.5s ease-out;
}

/* Boutons de cas actifs */
.case-button.active {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

/* Effet hover */
.btn-lg:hover {
    transform: scale(1.02);
    transition: transform 0.2s;
}

/* Badges num√©riques */
.badge {
    font-size: 0.9rem;
    padding: 0.4rem 0.6rem;
}

/* Messages de cas */
.case-title {
    font-weight: bold;
    color: inherit;
}

.case-instruction {
    font-size: 1.3rem;
    font-weight: bold;
}

@media (max-width: 768px) {
    #cube-goal svg {
        max-width: 280px;
    }
    
    /* Mini cubes dans la grille */
    #cube-case-1 svg,
    #cube-case-2 svg,
    #cube-case-3 svg,
    #cube-case-4 svg,
    #cube-case-5 svg,
    #cube-case-6 svg {
        max-width: 150px;
    }
    
    .move-icon-large {
        width: 60px;
        height: 80px;
    }
    
    .btn-lg {
        font-size: 1rem;
    }
    
    .display-1 {
        font-size: 3rem;
    }
    
    .corner-progress {
        font-size: 1.5rem;
        min-width: 40px;
    }
    
    .case-label {
        font-size: 0.9rem;
    }
}
</style>

<!-- Script JavaScript -->
<script type="module">
  import { renderCube } from "{% static 'cube/js/cube_renderer.js' %}";

  function mountCube(containerId, state) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    container.innerHTML = '';

    if (!state) {
      container.innerHTML = `
        <div class="alert alert-secondary text-center py-4">
          <i class="bi bi-cube text-muted" style="font-size: 3rem;"></i>
          <p class="mb-0 mt-2 text-muted">Cube non disponible</p>
        </div>
      `;
      return;
    }

    const template = document.getElementById("cube-template");
    const clone = template.content.cloneNode(true);
    container.appendChild(clone);

    const svg = container.querySelector("svg");
    renderCube(svg, state);
  }

  // Les 6 √©tats des cas
  const caseStates = {
    1: {{ case_1_state|safe }},
    2: {{ case_3_state|safe }},
    3: {{ case_2_state|safe }},
    4: {{ wrong_bottom_corner|safe }}, 
    5: {{ two_wrong_color|safe }},  
    6: {{ one_wrong_color|safe }},
  };

  document.addEventListener("DOMContentLoaded", () => {
    mountCube("cube-goal", {{ goal_state|safe }});
    
    // Mount tous les 6 cas
    mountCube("cube-case-1", caseStates[1]);
    mountCube("cube-case-2", caseStates[2]);
    mountCube("cube-case-3", caseStates[3]);
    mountCube("cube-case-4", caseStates[4]);
    mountCube("cube-case-5", caseStates[5]);
    mountCube("cube-case-6", caseStates[6]);
  });
</script>

{% endblock %}
{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}La face jaune ‚Äî Francontcube{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Titre principal avec emoji -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            üêü √âtape 6 : <span class="brand-green">La chasse au poisson!</span>
        </h1>
        <p class="lead">
            Compl√®te toute la face jaune en chassant le poisson
        </p>
    </div>

    <!-- Charger le template SVG (cach√©) -->
    {% include "cube/partials/_cube_svg.html" %}

    <!-- Warning for missing cube states -->
    {% if missing_slugs %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">‚ö†Ô∏è Missing Cube States</h4>
        <p>The following CubeState objects need to be created in the database:</p>
        <ul class="mb-0">
            {% for slug in missing_slugs %}
            <li><code>{{ slug }}</code></li>
            {% endfor %}
        </ul>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <!-- C'est quoi le but? -->
    <div class="card border-success border-3 shadow-sm mb-4">
        <div class="card-body text-center p-5">
            <h2 class="mb-4">üéØ C'est quoi le but?</h2>
            <div class="d-flex justify-content-center mb-3">
                <div id="cube-goal"></div>
            </div>
            <h4 class="brand-green">Toute la face jaune compl√®te!</h4>
            <p class="lead mb-0">Tous les coins doivent √™tre jaunes en haut üü®</p>
        </div>
    </div>

    <!-- L'algorithme du poisson - UNE SEULE FOIS -->
    <div class="card bg-gradient shadow-sm mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="card-body text-center text-white p-5">
            <h2 class="mb-4">üêü L'algorithme du poisson!</h2>
            <p class="lead mb-4">Ton ami <strong>R U R' U'</strong> mais avec U au lieu de U' + R U2 R' √† la fin!</p>
            
            <div class="p-4 bg-white bg-opacity-25 rounded-3 d-inline-block mb-4">
                <div class="d-flex justify-content-center align-items-center gap-3 flex-wrap">
                    <svg class="move-icon-large"><use href="#R"/></svg>
                    <svg class="move-icon-large"><use href="#U"/></svg>
                    <svg class="move-icon-large"><use href="#R-prime"/></svg>
                    <svg class="move-icon-large"><use href="#U"/></svg>
                    <svg class="move-icon-large"><use href="#R"/></svg>
                    <svg class="move-icon-large"><use href="#U2"/></svg>
                    <svg class="move-icon-large"><use href="#R-prime"/></svg>
                </div>
            </div>
           
            
            <div class="alert alert-light text-dark">
                <p class="lead mb-0">Tu vas r√©p√©ter cet algorithme 1 √† 5 fois - c'est normal! üîÑ</p>
            </div>
        </div>
    </div>

    <!-- Le BON poisson -->
    <div class="card border-success border-3 shadow-sm mb-4">
        <div class="card-body p-4">
            <h2 class="text-center mb-4">üêü Cherche le BON poisson!</h2>
            
            <div class="row justify-content-center">
                <div class="col-md-6 text-center">
                    <div class="p-4 bg-light rounded">
                        <h4 class="text-success mb-3">‚úÖ Le BON poisson (Sune)</h4>
                            <div class="d-flex justify-content-center mb-3">
                                <img src="{% static 'francontcube/img/sune.png' %}" 
                                     alt="Sune pattern - Le bon poisson" 
                                     class="img-fluid rounded shadow"
                                     style="max-width: 350px;">
                            </div>
                    </div>
                </div>
            </div>

            <div class="alert alert-info text-center mt-4 mb-0">
                <strong>üí° Tu ne vois pas le poisson?</strong> Fais l'algo jusqu'a 3 fois!
            </div>
        </div>
    </div>

    <!-- Les autres formes -->
    <div class="card shadow-sm mb-4">
        <div class="card-body p-4">
            <h2 class="text-center mb-4">üéÆ Les autres formes que tu pourrais voir</h2>
            <p class="text-center lead mb-4">Fais l'algorithme jusqu'√† voir le BON poisson!</p>
            
            <!-- Premi√®re rang√©e - 3 Sunes n√©cessaires -->
            <h4 class="text-center text-primary mb-3">Ces formes = 3x l'algorithme</h4>
            <div class="row mb-4">
                <div class="col-md-4 text-center mb-3">
                    <div class="pattern-card p-3 border rounded">
                        <h6>Superman</h6>
                        <div class="d-flex justify-content-center mb-2">
                            <div id="cube-superman"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-center mb-3">
                    <div class="pattern-card p-3 border rounded">
                        <h6>Chameleon</h6>
                        <div class="d-flex justify-content-center mb-2">
                            <div id="cube-chameleon"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-center mb-3">
                    <div class="pattern-card p-3 border rounded">
                        <h6>Bowtie</h6>
                        <div class="d-flex justify-content-center mb-2">
                            <div id="cube-bowtie"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deuxi√®me rang√©e - 2 Sunes n√©cessaires -->
            <h4 class="text-center text-info mb-3">Ces formes = 2x l'algorithme</h4>
            <div class="row">
                <div class="col-md-4 text-center mb-3">
                    <div class="pattern-card p-3 border rounded">
                        <h6>Pi</h6>
                        <div class="d-flex justify-content-center mb-2">
                            <div id="cube-pi"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-center mb-3">
                    <div class="pattern-card p-3 border rounded">
                        <h6>Double Sune</h6>
                        <div class="d-flex justify-content-center mb-2">
                            <div id="cube-doublesune"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-center mb-3">
                    <div class="pattern-card p-3 border rounded bg-warning bg-opacity-10">
                        <h6>AntiSune (Mauvais poisson)</h6>
                        <div class="d-flex justify-content-center mb-2">
                            <div id="cube-antisune"></div>
                        </div>
                        <small class="text-danger">Oriente-le comme le bon poisson!</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comment faire - 3 √©tapes simples -->
    <div class="card border-warning border-2 shadow-sm mb-4">
        <div class="card-body p-4">
            <h3 class="text-center mb-4">üìù Comment faire? (3 √©tapes!)</h3>
            
            <div class="row">
                <div class="col-md-4 text-center mb-4">
                    <div class="display-1 text-primary">1Ô∏è‚É£</div>
                    <h4 class="mt-3 brand-green">Cherche</h4>
                    <p class="lead">Trouve le BON poisson ou les autres formes possible</p>
                </div>
                
                <div class="col-md-4 text-center mb-4">
                    <div class="display-1 text-info">2Ô∏è‚É£</div>
                    <h4 class="mt-3 brand-green">Oriente</h4>
                    <p class="lead">Oriente ta face U pour correspondre aux formes</p>
                </div>
                
                <div class="col-md-4 text-center mb-4">
                    <div class="display-1 text-success">3Ô∏è‚É£</div>
                    <h4 class="mt-3 brand-green">R√©p√®te</h4>
                    <p class="lead">Fais l'algorithme jusqu'√† ce que tout soit jaune!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Encouragement final -->
    <div class="card bg-success text-white shadow-sm mb-4">
        <div class="card-body text-center p-5">
            <h2 class="mb-3">üåü Tu es √† 75% du cube r√©solu!</h2>
            <p class="lead mb-0">
                Continue de r√©p√©ter l'algorithme du poisson!<br>
                Tu vas y arriver! üéâ
            </p>
        </div>
    </div>

    <!-- Navigation -->
    <div class="d-flex justify-content-between flex-wrap gap-2">
        <a href="{% url 'francontcube:cubienewbie_yellow_cross' %}" class="btn btn-outline-primary btn-lg">
            ‚Üê Croix jaune
        </a>
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-outline-secondary btn-lg">
            üè† Menu
        </a>
        <a href="{% url 'francontcube:cubienewbie_corner_permutation' %}" class="btn btn-success btn-lg">
            Permutation des coins ‚Üí
        </a>
    </div>
</div>

<!-- Styles CSS -->
<style>
/* Cubes */
#cube-goal svg {
    max-width: 350px;
    height: auto;
}

#cube-sune svg {
    max-width: 250px;
    height: auto;
}

#cube-superman svg,
#cube-chameleon svg,
#cube-bowtie svg,
#cube-pi svg,
#cube-doublesune svg,
#cube-antisune svg {
    max-width: 150px;
    height: auto;
}

/* Ic√¥nes de mouvements */
.move-icon-large {
    width: 60px;
    height: 81px;
}

/* Pattern cards */
.pattern-card {
    background: white;
    transition: transform 0.2s;
    min-height: 100%;
}

.pattern-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Animation */
@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-in {
    animation: slideIn 0.5s ease-out;
}

/* Effet hover */
.btn-lg:hover {
    transform: scale(1.02);
    transition: transform 0.2s;
}

@media (max-width: 768px) {
    #cube-goal svg {
        max-width: 280px;
    }
    
    #cube-sune svg {
        max-width: 200px;
    }
    
    #cube-superman svg,
    #cube-chameleon svg,
    #cube-bowtie svg,
    #cube-pi svg,
    #cube-doublesune svg,
    #cube-antisune svg {
        max-width: 130px;
    }
    
    .move-icon-large {
        width: 50px;
        height: 67px;
    }
    
    .btn-lg {
        font-size: 1rem;
    }
    
    .display-1 {
        font-size: 3rem;
    }
}
</style>

<!-- Script JavaScript -->
<script type="module">
  import { renderCube } from "{% static 'cube/js/cube_renderer.js' %}";

  function mountCube(containerId, state) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    container.innerHTML = '';

    if (!state) {
      container.innerHTML = `
        <div class="alert alert-secondary text-center py-4">
          <i class="bi bi-cube text-muted" style="font-size: 3rem;"></i>
          <p class="mb-0 mt-2 text-muted">Cube non disponible</p>
        </div>
      `;
      return;
    }

    const template = document.getElementById("cube-template");
    const clone = template.content.cloneNode(true);
    container.appendChild(clone);

    const svg = container.querySelector("svg");
    renderCube(svg, state);
  }

  document.addEventListener("DOMContentLoaded", () => {
    mountCube("cube-goal", {{ goal_state|safe }});
    mountCube("cube-sune", {{ yellow_sune_state|safe }});
    
    // 3 Sunes
    mountCube("cube-superman", {{ yellow_superman_state|safe }});
    mountCube("cube-chameleon", {{ yellow_chameleon_state|safe }});
    mountCube("cube-bowtie", {{ yellow_bowtie_state|safe }});
    
    // 2 Sunes
    mountCube("cube-pi", {{ yellow_pi_state|safe }});
    mountCube("cube-doublesune", {{ yellow_doublesune_state|safe }});
    mountCube("cube-antisune", {{ yellow_antisune_state|safe }});
  });
</script>

{% endblock %}
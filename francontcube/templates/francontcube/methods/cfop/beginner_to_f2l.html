{% extends "francontcube/partials/base.html" %}
{% load static %}

{% block title %}La deuxi√®me couche ‚Äì Francontcube{% endblock %}

{% block content %}
<div class="container py-5">

    <!-- Titre principal -->
    <div class="text-center mb-5">
        <h1 class="hero-title">
            <span class="brand-green">De d√©butant √† F2L</span>
        </h1>
        <p class="lead text-muted">
            Placer les coins et les ar√™tes du milieu d'un seul coup pour compl√©ter les deux premi√®res couches du cube.
        </p>
    </div>

    
    <!-- Charger le template SVG (cach√©) -->
    {% include "cube/partials/_cube_svg.html" %}

    <!-- Warning for missing cube states (only shown if any are missing) -->
    {% if missing_slugs %}
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <h4 class="alert-heading">‚ö†Ô∏è Missing Cube States</h4>
        <p>The following CubeState objects need to be created in the database:</p>
        <ul class="mb-0">
            {% for slug in missing_slugs %}
            <li><code>{{ slug }}</code></li>
            {% endfor %}
        </ul>
        <hr>
        <p class="mb-0 small">Use your cube state creation tool to add these. The page will display placeholders until they're created.</p>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <!-- Section Objectif -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üéØ Objectif</h3>
        <p>
            Comprendre que les algorithmes utilis√©s pour r√©soudre les ar√™tes du milieu sont en r√©alit√© des mouvements F2L et de <strong>comprendre son fonctionnement.</strong> 
        </p>
    </div>

    <!-- Section Cas sp√©cial -->
    <div class="card p-4 mb-4 border-warning">
        <h3 class="brand-green">Exemple 1 - Regardons un premier cas tr√®s facile</h3>
        <p>
            Puisque <strong>le collant blanc</strong> du coin vise le c√¥t√© <strong>droit</strong>, on fait simplement le R U R' pour le placer.
        </p>

        <div class="row mt-3 align-items-center">
            <div class="col-md-4 text-center">
                <div id="cube-case-fl2-01" class="cube-case"></div>
                <p class="mt-2"><small>O√π est l'ar√™te rouge-vert!</small></p>
            </div>
            <div class="col-md-8">
                <div class="bg-white p-3 rounded border border-warning border-2">
                    <h5>Solution :</h5>
                    <ol class="mb-0">
                        <li><svg class="move-icon"><use href="#R"/></svg> Place le coin rouge-vert-blanc avec l'ar√™te rouge-vert.</li>
                        <li><svg class="move-icon"><use href="#U"/></svg> Place la paire dans la couche de droite avec les autres collants blancs</li>
                        <li><svg class="move-icon"><use href="#R-prime"/></svg> Place le tout √† la bonne place (slot).</li>
                    </ol>
                </div>
            </div>

            <div class="d-flex justify-content-center align-items-center gap-2 my-3 flex-wrap">
                <div class="alert alert-success w-100 text-center">
                    <h5 class="brand-green mb-0">üí° Donc, en F2L on s'organise pour attacher le bon ar√™te au coin avant de l'ins√©rer √† sa place</h5>
                </div>
            </div>
        </div>
    </div>

    <!-- Section Algorithmes -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">Exemple 2 : Le cas de la m√©thode de d√©butant</h3>
        <p>L'algorithme pour ajouter l'ar√™te √† la deuxi√®me couche est en r√©alit√© du F2L.</p>

        <!-- Cas 1: Ar√™te va √† GAUCHE -->
        <div class="border rounded p-3 mb-3 bg-light">
            <h5 class="text-success">Le U' F' U F pr√©pare la paire ar√™te-coin et le U R U' R' ins√®re la paire √† la bonne place</h5>
            
            <div class="row align-items-center">
                <div class="col-md-4 text-center">
                    <div id="cube-case-left" class="cube-case"></div>
                    <p class="mt-2"><small>Position de d√©part</small></p>
                </div>
                <div class="col-md-8">
                    <div class="text-center p-3 bg-white rounded border border-success border-2">
                        <div class="d-flex justify-content-center align-items-center gap-2 my-2 flex-wrap">
                            <svg class="move-icon"><use href="#U-prime"/></svg>
                            <svg class="move-icon"><use href="#F-prime"/></svg>
                            <svg class="move-icon"><use href="#U"/></svg>
                            <svg class="move-icon"><use href="#F"/></svg>
                            <svg class="move-icon"><use href="#U"/></svg>
                            <svg class="move-icon"><use href="#R"/></svg>
                            <svg class="move-icon"><use href="#U-prime"/></svg>
                            <svg class="move-icon"><use href="#R-prime"/></svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section Technique -->
    <div class="card p-4 mb-4 border-success">
        <h3 class="brand-green">‚úã Vous avez deux mains!</h3>
        <div class="alert alert-success">
            <strong>Jusqu'√† pr√©sent, on vous informait de tenir le cube avec la main gauche et de faire les mouvements avec la main droite.</strong>
            
            <p class="mt-3 mb-2">En F2L, vous utilisez les deux mains de mani√®re √©gale :</p>
            <ul class="mb-0">
                <li>Il y a <strong>41 cas F2L</strong> en tout</li>
                <li>15 d'entre eux ont une <strong>version miroir</strong> sur le c√¥t√© gauche du cube</li>
                <li>Ces cas miroirs s'ex√©cutent avec la <strong>main gauche</strong></li>
                <li><strong>Conseil :</strong> Pratiquez lentement, puis acc√©l√©rez progressivement</li>
            </ul>
        </div>
        
        <div class="alert alert-info mb-0">
            <strong>üí° Exemple pour l'algorithme de GAUCHE (U' L' U L U F U' F') :</strong>
            <ul class="mb-0 mt-2">
                <li><strong>Main droite :</strong> tient le cube</li>
                <li><strong>Main gauche :</strong> fait les mouvements L et U</li>
                <li><strong>Index gauche :</strong> fait aussi les mouvements F</li>
            </ul>
        </div>
    </div>

    <!-- NOUVELLE SECTION: Comparaison -->
    <div class="card p-4 mb-4 border-primary">
        <h3 class="brand-green">‚ö° Pourquoi passer au F2L?</h3>
        
        <div class="row mt-3">
            <div class="col-md-6 mb-3">
                <div class="card h-100 border-danger">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">‚ùå M√©thode d√©butant</h5>
                    </div>
                    <div class="card-body">
                        <ul class="mb-0">
                            <li><strong>2 √©tapes s√©par√©es :</strong> coins blancs puis ar√™tes du milieu</li>
                            <li>Beaucoup de r√©p√©titions de mouvements</li>
                            <li>Nombreuses rotations du cube</li>
                            <li><strong>Temps moyen :</strong> ~25-35 secondes pour les 2 premi√®res couches</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card h-100 border-success">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">‚úÖ M√©thode F2L</h5>
                    </div>
                    <div class="card-body">
                        <ul class="mb-0">
                            <li><strong>1 seule √©tape :</strong> coin + ar√™te ensemble</li>
                            <li>Mouvements plus fluides et rapides</li>
                            <li>Moins de rotations n√©cessaires</li>
                            <li><strong>Temps moyen :</strong> ~10-15 secondes pour les 2 premi√®res couches</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-warning mt-3 mb-0">
            <h5>üìä Gain de performance</h5>
            <p class="mb-0">
                Le F2L peut vous faire <strong>gagner jusqu'√† 50% du temps</strong> sur les deux premi√®res couches ! 
                C'est l'am√©lioration la plus importante pour passer d'un temps de r√©solution de 1-2 minutes √† moins de 30 secondes.
            </p>
        </div>
    </div>

    <!-- NOUVELLE SECTION: Plan d'apprentissage -->
    <div class="card p-4 mb-4">
        <h3 class="brand-green">üéì Comment apprendre le F2L?</h3>
        
        <p class="lead">Ne vous inqui√©tez pas ! Vous n'avez pas besoin d'apprendre les 41 cas d'un coup.</p>
        
        <div class="row mt-4">
            <div class="col-md-4 mb-3">
                <div class="card h-100 border-info">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">üü¢ √âtape 1 : Les bases</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Commencez par les 4 cas les plus simples</strong></p>
                        <ul class="mb-0">
                            <li>Paire d√©j√† form√©e</li>
                            <li>Insertion simple</li>
                            <li>Temps d'apprentissage : <strong>1-2 jours</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-3">
                <div class="card h-100 border-warning">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">üü° √âtape 2 : Cas courants</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Apprenez les 10-15 cas les plus fr√©quents</strong></p>
                        <ul class="mb-0">
                            <li>Coin et ar√™te s√©par√©s</li>
                            <li>Reconnaissance intuitive</li>
                            <li>Temps d'apprentissage : <strong>1-2 semaines</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-3">
                <div class="card h-100 border-danger">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">üî¥ √âtape 3 : Cas avanc√©s</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Ma√Ætrisez tous les 41 cas</strong></p>
                        <ul class="mb-0">
                            <li>Cas complexes et rares</li>
                            <li>F2L intuitif et optimis√©</li>
                            <li>Temps d'apprentissage : <strong>1-3 mois</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NOUVELLE SECTION: Conseils pratiques -->
    <div class="card p-4 mb-4 border-success">
        <h3 class="brand-green">üí™ Conseils pour r√©ussir votre transition</h3>
        
        <div class="row">
            <div class="col-md-6">
                <h5 class="text-success">‚úÖ √Ä FAIRE</h5>
                <ul>
                    <li><strong>Pratiquez lentement</strong> au d√©but - la vitesse viendra naturellement</li>
                    <li><strong>Regardez le cube pendant la r√©solution</strong> pour anticiper les prochaines paires</li>
                    <li><strong>R√©solvez 1-2 paires en F2L</strong> puis terminez en m√©thode d√©butant pour vous habituer progressivement</li>
                    <li><strong>Utilisez les deux mains</strong> d√®s le d√©but pour les cas miroirs</li>
                    <li><strong>Chronom√©trez-vous</strong> pour suivre vos progr√®s</li>
                </ul>
            </div>
            
            <div class="col-md-6">
                <h5 class="text-danger">‚ùå √Ä √âVITER</h5>
                <ul>
                    <li><strong>Ne vous d√©couragez pas</strong> si vous √™tes plus lent au d√©but - c'est normal!</li>
                    <li><strong>N'apprenez pas tous les cas en une fois</strong> - progressez par √©tapes</li>
                    <li><strong>Ne n√©gligez pas la croix blanche</strong> - elle reste importante pour un bon F2L</li>
                    <li><strong>N'abandonnez pas la m√©thode d√©butant trop vite</strong> - utilisez-la comme filet de s√©curit√©</li>
                    <li><strong>Ne vous comparez pas aux speedcubers</strong> - chacun progresse √† son rythme</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- NOUVELLE SECTION: Prochaine √©tape -->
    <div class="card p-4 mb-4 bg-light">
        <h3 class="brand-green">üöÄ Prochaine √©tape</h3>
        
        <p class="lead">Vous avez deux options pour continuer votre apprentissage :</p>
        
        <div class="row mt-3">
            <div class="col-md-6 mb-3">
                <div class="card h-100 border-primary">
                    <div class="card-body text-center">
                        <h4 class="card-title text-primary">Option 1 : Continuer la m√©thode d√©butant</h4>
                        <p>Finissez d'apprendre toutes les √©tapes, puis revenez au F2L quand vous serez √† l'aise.</p>
                        <a href="{% url 'francontcube:beginner_yellow_cross' %}" class="btn btn-primary">
                            √âtape suivante : La croix jaune ‚Üí
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card h-100 border-success">
                    <div class="card-body text-center">
                        <h4 class="card-title text-success">Option 2 : Plonger dans le F2L</h4>
                        <p>Commencez √† apprendre les cas F2L d√®s maintenant et progressez √† votre rythme.</p>
                        <a href="{% url 'francontcube:cfop_f2l_category' 'basic' %}" class="btn btn-success">
                            D√©couvrir les cas F2L ‚Üí
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-info mt-3 mb-0 text-center">
            <strong>üí° Recommandation :</strong> Si vous r√©solvez le cube en moins de 1 minute 30, commencez le F2L maintenant. 
            Sinon, terminez d'abord la m√©thode d√©butant pour avoir une base solide.
        </div>
    </div>

    <!-- Boutons de navigation -->
    <div class="text-center mt-5">
        <a href="{% url 'francontcube:beginner_bottom_corners' %}" class="btn btn-outline-primary">
            ‚Üê Retour : Les coins blancs
        </a>
        <a href="{% url 'francontcube:method_cubienewbie' %}" class="btn btn-outline-secondary ms-2">
            Vue d'ensemble
        </a>
        <a href="{% url 'francontcube:beginner_yellow_cross' %}" class="btn btn-success ms-2">
            Continuer : La croix jaune ‚Üí
        </a>
        <a href="{% url 'francontcube:cfop_f2l_category' 'basic' %}" class="btn btn-success ms-2">
            Apprendre le F2L ‚Üí
        </a>
    </div>
</div>

<!-- Styles CSS pour les cubes -->
<style>
.cube-small svg {
    max-width: 275px;
    height: auto;
}

.move-icon { 
    width: 56px; 
    height: 75px; 
}

.cube-case svg {
    max-width: 220px;
    height: auto;
}

@media (max-width: 768px) {
    .cube-small svg {
        max-width: 200px;
    }
    
    .cube-case svg {
        max-width: 180px;
    }
}

.card {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}
</style>

<!-- Script d'initialisation de la page -->
<script type="module">
  import { renderCube } from "{% static 'cube/js/cube_renderer.js' %}";

  function mountCube(containerId, state) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    if (!state) {
      container.innerHTML = `
        <div class="alert alert-secondary text-center py-4">
          <i class="bi bi-cube text-muted" style="font-size: 3rem;"></i>
          <p class="mb-0 mt-2 text-muted">Cube state not available</p>
          <small class="text-muted">Create the CubeState in your admin tool</small>
        </div>
      `;
      return;
    }
    
    const template = document.getElementById("cube-template");
    const clone = template.content.cloneNode(true);
    container.appendChild(clone);

    const svg = container.querySelector("svg");
    renderCube(svg, state);
  }

  document.addEventListener("DOMContentLoaded", () => {
    mountCube("cube-case-left", {{ case_left_state|safe }});
    mountCube("cube-case-fl2-01", {{ case_f2l_01_state|safe }});
  });
</script>

{% endblock %}
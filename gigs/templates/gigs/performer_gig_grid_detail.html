{% extends "base_uke4ia.html" %}
{% block title %}{{ gig.title }} at {{ venue.name }}{% endblock %}

{% block content %}
<style>
    /* Inline gig card styling */
    .gig-card {
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 16px;
        background: #fff;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }
    
    .gig-card h3 {
        margin-top: 0;
    }
    
    .gig-card .description {
        margin-top: 8px;
        color: #444;
        font-size: 0.95rem;
        line-height: 1.4;
    }
    
    .gig-card .description ul,
    .gig-card .description ol {
        margin: 0.4em 0 0.4em 1.2em;
    }
    
    .gig-card .description li {
        margin-bottom: 0.2em;
    }
    </style>
<a href="{% url 'gigs:performer_gig_grid' %}" class="btn btn-outline-secondary mb-4">
    &larr; Back to Venue Grid
</a>

<div class="row g-4">
    <!-- Left: Gig Detail -->
    <div class="col-lg-8">
        <div class="card shadow-sm mb-4">
            {% if venue.image %}
                <img src="{{ venue.image.url }}" class="card-img-top" alt="{{ venue.name }}">
            {% endif %}
            <div class="card-body">
                <h1 class="card-title mb-3">{{ gig.title }}</h1>
                <p><strong>ðŸŽ¤ Venue:</strong> {{ venue.name }}</p>
                <p><strong>ðŸ“… Date:</strong> {{ gig.date }} {{ gig.start_time }}
                    {% if gig.end_time %}- {{ gig.end_time }}{% endif %}
                </p>
                {% if gig.attire %}<p><strong>ðŸ‘” Attire:</strong> {{ gig.attire }}</p>{% endif %}
                {% if gig.chairs %}<p><strong>ðŸª‘ Chairs:</strong> {{ gig.chairs }}</p>{% endif %}
                {% if gig.arrive_by %}
        <p><strong>Arrive By:</strong> {{ gig.arrive_by|time:"g:i A" }}</p>
    {% endif %}

    {% if gig.description %}
        <div class="description">
            {{ gig.description|safe }}
        </div>
    {% endif %}
            </div>
        </div>

        <div class="card shadow-sm mb-4">
            <div class="card-header bg-primary text-white fw-bold">Your Availability</div>
            <div class="card-body">
                <form method="post" class="d-flex align-items-center gap-3">
                    {% csrf_token %}
                    <select name="status" class="form-select w-auto" onchange="this.form.submit()">
                        {% for code,label in availability.AVAILABILITY_CHOICES %}
                            <option value="{{ code }}" {% if availability.status == code %}selected{% endif %}>
                                {{ label }}
                            </option>
                        {% endfor %}
                    </select>
                    <small class="text-muted">Change your status from the dropdown.</small>
                </form>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white fw-bold">All Performers</div>
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle mb-0">
                    <thead class="table-dark">
                        <tr><th>Performer</th><th>Status</th></tr>
                    </thead>
                    <tbody>
                        {% for av in all_availabilities %}
                            <tr>
                                <td>{{ av.player.get_full_name|default:av.player.username }}</td>
                                <td>
                                    {% if av.status == "Y" %}
                                        <span class="badge bg-success">Yes</span>
                                    {% elif av.status == "N" %}
                                        <span class="badge bg-danger">No</span>
                                    {% elif av.status == "M" %}
                                        <span class="badge bg-warning text-dark">Maybe</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% empty %}
                            <tr><td colspan="2" class="text-center text-muted py-4">No responses yet.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Right: Venue Gigs Sidebar -->
    <div class="col-lg-4">
        <div class="card shadow-sm">
            <div class="card-header bg-info text-white fw-bold text-center">
                Other Gigs at {{ venue.name }}
            </div>
            <ul class="list-group list-group-flush">
                {% for v_gig in venue_gigs %}
                <li class="list-group-item {% if gig.id == v_gig.id %}active{% endif %}">
                    <a href="{% url 'gigs:performer_gig_grid_detail' v_gig.id %}"
                       class="d-flex justify-content-between text-decoration-none {% if gig.id == v_gig.id %}text-white{% endif %}">
                        <span>{{ v_gig.title }}</span>
                        <small>{{ v_gig.date }}</small>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% for column in columns %}
  {% if column.column_type != 'venue' %}
    <div class="board-column" style="flex: 0 0 300px; background: #f8f8f8; border-radius: 6px; padding: 10px;">
      <h4>{{ column.name }}</h4>
      <div class="sortable-list" data-column-id="{{ column.id }}">
        {% for item in column.items.all|dictsort:"position" %}
          <div class="card" data-item-id="{{ item.id }}"
               style="background:white; padding:10px; margin-bottom:10px; border-radius:4px; cursor:grab;">
            
            {% if item.is_rehearsal %}
              <!-- Rehearsal Card -->
              <strong>{{ item.title }}</strong><br>
              <p><strong>Your response:</strong>
                {% if item.my_availability == 'yes' %}
                  ✅ Coming
                {% elif item.my_availability == 'maybe' %}
                  ❓ Maybe
                {% elif item.my_availability == 'no' %}
                  ❌ Can't
                {% else %}
                  🚫 No response yet
                {% endif %}
              </p>
              <small class="text-muted">📅 {{ item.event_date|date:"M d, Y H:i" }}</small><br>

              <!-- Click for details button -->
              <button class="btn btn-sm btn-outline-info mt-2"
                      data-bs-toggle="modal"
                      data-bs-target="#rehearsalDetailModal{{ item.id }}">
                📄 Click for Details
              </button>

              <!-- Modal -->
              <div class="modal fade" id="rehearsalDetailModal{{ item.id }}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">{{ item.title }} - Details</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <p><strong>Date:</strong> {{ item.event_date|date:"M d, Y H:i" }}</p>
                      <p><strong>Location:</strong> {{ item.location }}</p>
                      <p><strong>Notes:</strong></p>
                      <div class="rtf-notes">
                        {{ item.rich_description|safe }}
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>

            {% else %}
              <!-- Non-Rehearsal Card -->
              <strong>{{ item.title }}</strong><br>
              
              {% if item.cover_photo %}
                <img src="{{ item.cover_photo.image.url }}" alt="Cover photo" style="max-width:100%; border-radius:4px;" />
              {% endif %}
              
              {{ item.description|linebreaks }}

              {% if item.youtube_url %}
                <div class="ratio ratio-16x9 my-2">
                  <iframe src="https://www.youtube.com/embed/{{ item.youtube_url|cut:'https://youtu.be/'|cut:'https://www.youtube.com/watch?v=' }}"
                          title="YouTube video"
                          allowfullscreen
                          style="border:0;">
                  </iframe>
                </div>
              {% endif %}
              
              {% if item.column.column_type == "photos" and item.photos.exists %}
                <p>
                  <a href="#" class="btn btn-sm btn-outline-primary"
                     data-bs-toggle="modal"
                     data-bs-target="#photoGalleryModal"
                     data-item-id="{{ item.id }}"
                     data-item-title="{{ item.title }}">
                    📷 View Photo Gallery
                  </a>
                </p>
              {% endif %}
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endfor %}

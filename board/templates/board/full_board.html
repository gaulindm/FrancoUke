{% extends 'base_uke4ia.html' %}
{% load board_extras %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/lightbox2@2/dist/css/lightbox.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/lightbox2@2/dist/js/lightbox-plus-jquery.min.js"></script>
<div class="board-row">
  {% include 'partials/_other_board_columns.html' %}
</div>

<style>
.board-row {
  display: flex !important;
  flex-direction: row !important;
  flex-wrap: nowrap !important;   /* ‚úÖ never wrap to new row */
  gap: 20px;
  align-items: flex-start;
  justify-content: flex-start;    /* ‚úÖ don‚Äôt spread to edges */
  overflow-x: auto;
  padding-bottom: 20px;
  border: 2px dashed red;         /* üîç temp debug: make container visible */
}

.board-column {
  flex: 0 0 300px !important;     /* ‚úÖ force fixed width */
  max-width: 300px !important;
  background: #f9f9f9;
  border-radius: 6px;
  padding: 10px;
  border: 2px solid blue;         /* üîç temp debug: make each column visible */
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('photoGalleryModal');
    modal.addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget;
      const itemId = button.getAttribute('data-item-id');
      const itemTitle = button.getAttribute('data-item-title');
      const modalTitle = modal.querySelector('.modal-title');
      const modalBody = document.getElementById('photoGalleryContent');
  
      modalTitle.textContent = `üì∑ ${itemTitle}`;
      modalBody.innerHTML = '<p>Loading photos...</p>';
  
      fetch(`/board/api/items/${itemId}/photos/`)
        .then(response => response.json())
        .then(data => {
          // ‚úÖ Handle both array and object response formats
          const photos = Array.isArray(data) ? data : (data.photos || []);
  
          if (photos.length === 0) {
            modalBody.innerHTML = '<p>No photos found.</p>';
            return;
          }
  
          const galleryHTML = photos.map(photo => `
            <a href="${photo.url}" data-lightbox="item-${itemId}" data-title="${photo.caption || ''}">
              <img src="${photo.url}" class="img-fluid mb-3" style="max-height: 200px; margin-right: 10px;" />
            </a>
          `).join('');
  
          modalBody.innerHTML = `<div class="d-flex flex-wrap">${galleryHTML}</div>`;
        })
        .catch(err => {
          modalBody.innerHTML = '<p class="text-danger">Failed to load photos.</p>';
          console.error("Photo gallery error:", err);
        });
  
    });
  });
  </script>
  
{% endblock %}

{% load static %}
{# partials/_event_card.html #}
<div class="card"
     style="background:white; padding:10px; margin-bottom:10px; border-radius:4px; cursor:pointer;"
     data-bs-toggle="modal" data-bs-target="#eventModal{{ event.id }}">

 <!-- Card Cover (use Venue image) -->
 {% if event.venue and event.venue.image %}
 <!-- Venue image -->
 <img src="{{ event.venue.image.url }}" 
      alt="{{ event.venue.name }}"
      style="max-width:100%; height:auto; border-radius:4px; display:block; margin:0 auto;">
{% elif event.cover_photo %}
 <!-- Event cover photo fallback -->
 <img src="{{ event.cover_photo.image.url }}" 
      alt="{{ event.title }}"
      style="max-width:100%; height:auto; border-radius:4px; display:block; margin:0 auto;">
{% else %}
 <!-- Placeholder -->
 <div style="background:#eee; padding:20px; text-align:center; border-radius:4px; color:#888;">
   ❌ No image available
 </div>
{% endif %}


<!-- Title -->
<div class="d-flex justify-content-between align-items-center mt-2">
  <h6 class="mb-0">{{ event.title }}</h6>
</div>

<!-- Date and Time + Availability -->
<table class="table table-sm table-borderless align-middle mb-2">
  <tr>
    <td class="text-muted small">
      {% if event.event_date %}
        <strong>Date:</strong> {{ event.event_date|date:"M d, Y" }}
      {% endif %}
    </td>
    <td rowspan="2" class="text-end">
      {% if event.my_availability == "yes" %}
        <span class="badge bg-success" title="Available">Y</span>
      {% elif event.my_availability == "no" %}
        <span class="badge bg-danger" title="Not Available">N</span>
      {% elif event.my_availability == "maybe" %}
        <span class="badge bg-warning text-dark" title="Maybe">M</span>
      {% else %}
        <span class="badge bg-secondary" title="Unknown">–</span>
      {% endif %}
    </td>
  </tr>
  <tr>
    <td class="text-muted small">
      {% if event.start_time %}
        <strong>Time:</strong>
        {{ event.start_time|time:"g:i A" }}
        {% if event.end_time %}
          – {{ event.end_time|time:"g:i A" }}
        {% endif %}
      {% endif %}
    </td>
  </tr>
</table>

    
</div>



<!-- Modal -->
<div class="modal fade" id="eventModal{{ event.id }}" tabindex="-1"
     aria-labelledby="eventModalLabel{{ event.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ event.title }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        {% if event.cover_photo_url %}
        <img src="{{ event.cover_photo_url }}" alt="{{ event.title }}">
      {% else %}
        <img src="{% static 'images/fallback.jpg' %}" alt="No cover available">
      {% endif %}

        <p><strong>Date:</strong> {{ event.event_date|date:"M d, Y" }}</p>
        {% if event.start_time %}
          <p><strong>Time:</strong> {{ event.start_time|time:"g:i A" }}
            {% if event.end_time %} - {{ event.end_time|time:"g:i A" }}{% endif %}
          </p>
        {% endif %}

          <!-- Arrive by -->
          {% if event.arrive_by %}
            <p><strong>Arrive by:</strong> {{ event.arrive_by|time:"g:i A" }}</p>
          {% endif %}
        </small>


        <!-- Attire -->
          {% if event.attire %}
            <p><strong>Attire:</strong> {{ event.attire }}</p>
          {% endif %}
        </small>

          <!-- Chairs -->
            {% if event.chairs %}
              <p><strong>Chairs:</strong> {{ event.chairs }}</p>
            {% endif %}
          </small>


          <div class="description-preview">
            <!-- Short text (collapsed) -->
            <div class="short-text" style="max-height: 4.5em; overflow: hidden;">
              {{ event.rich_description|safe }}
            </div>
          
            <!-- Full text (expanded) -->
            <div class="full-text d-none">
              {{ event.rich_description|safe }}
            </div>
          
            <a href="#" class="toggle-description">See more</a>
          </div>






        <!-- Availability Form -->
        <form method="post" action="{% url 'set_event_availability' event.id %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="availability{{ event.id }}" class="form-label"><strong>Your Availability:</strong></label>
            <select id="availability{{ event.id }}" name="status" class="form-select">
              <option value="">-- Select --</option>
              <option value="yes" {% if event.my_availability == "yes" %}selected{% endif %}>✅ Yes</option>
              <option value="maybe" {% if event.my_availability == "maybe" %}selected{% endif %}>🤔 Maybe</option>
              <option value="no" {% if event.my_availability == "no" %}selected{% endif %}>❌ No</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Save</button>
        </form>

        <!-- Group Availability Summary -->
        {% if event.avail_summary %}
          <div class="mt-3">
            <strong>Group Availability:</strong><br>
            ✅ Yes: {{ event.avail_summary.yes }} |
            ❌ No: {{ event.avail_summary.no }} |
            🤔 Maybe: {{ event.avail_summary.maybe }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

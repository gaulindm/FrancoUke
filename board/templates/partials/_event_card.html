{# partials/_event_card.html #}
<div class="card"
     style="background:white; padding:10px; margin-bottom:10px; border-radius:4px; cursor:pointer;"
     data-bs-toggle="modal" data-bs-target="#eventModal{{ event.id }}">

  <!-- Cover / Media -->
  {% if event.cover_photo %}
    <img src="{{ event.cover_photo.image.url }}" alt="{{ event.title }}"
         style="max-width:100%; height:auto; border-radius:4px; display:block; margin:0 auto;">
  {% else %}
    <div style="background:#eee; padding:20px; text-align:center; border-radius:4px; color:#888;">
      ❌ No image available
    </div>
  {% endif %}

  <!-- Title + Availability -->
  <div class="d-flex justify-content-between align-items-center mt-2">
    <strong>{{ event.title }}</strong>
    {% if event.my_availability == "yes" %}
      <span class="badge bg-success">Y</span>
    {% elif event.my_availability == "no" %}
      <span class="badge bg-danger">N</span>
    {% elif event.my_availability == "maybe" %}
      <span class="badge bg-warning text-dark">M</span>
    {% else %}
      <span class="badge bg-secondary">–</span>
    {% endif %}
  </div>

  <!-- Date + Time -->
  <small class="text-muted">
    {% if event.event_date %}
      <p><strong>Date:</strong> {{ event.event_date|date:"M d, Y" }}</p>
    {% endif %}
    {% if event.start_time %}
      <p><strong>Time:</strong> {{ event.start_time|time:"g:i A" }}
        {% if event.end_time %} - {{ event.end_time|time:"g:i A" }}{% endif %}
      </p>
    {% endif %}
  </small>
</div>

<!-- Modal -->
<div class="modal fade" id="eventModal{{ event.id }}" tabindex="-1"
     aria-labelledby="eventModalLabel{{ event.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ event.title }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        {% if event.cover_photo %}
          <img src="{{ event.cover_photo.image.url }}" alt="{{ event.title }}" class="img-fluid mb-3 rounded">
        {% endif %}

        <p><strong>Date:</strong> {{ event.event_date|date:"M d, Y" }}</p>
        {% if event.start_time %}
          <p><strong>Time:</strong> {{ event.start_time|time:"g:i A" }}
            {% if event.end_time %} - {{ event.end_time|time:"g:i A" }}{% endif %}
          </p>
        {% endif %}

        <div>{{ event.rich_description|safe }}</div>

        <!-- Availability Form -->
        <form method="post" action="{% url 'set_event_availability' event.id %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="availability{{ event.id }}" class="form-label"><strong>Your Availability:</strong></label>
            <select id="availability{{ event.id }}" name="status" class="form-select">
              <option value="">-- Select --</option>
              <option value="yes" {% if event.my_availability == "yes" %}selected{% endif %}>✅ Yes</option>
              <option value="maybe" {% if event.my_availability == "maybe" %}selected{% endif %}>🤔 Maybe</option>
              <option value="no" {% if event.my_availability == "no" %}selected{% endif %}>❌ No</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Save</button>
        </form>

        <!-- Group Availability Summary -->
        {% if event.avail_summary %}
          <div class="mt-3">
            <strong>Group Availability:</strong><br>
            ✅ Yes: {{ event.avail_summary.yes }} |
            ❌ No: {{ event.avail_summary.no }} |
            🤔 Maybe: {{ event.avail_summary.maybe }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

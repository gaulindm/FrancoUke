{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="UTF-8">
  <title>{{ song.title }}</title>
  <link rel="stylesheet" href="{% static 'songbook/css/teleprompter.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- User Preferences -->
  {% if user.is_authenticated and user.userpreference %}
  <script>
    window.userPreferences = {
      instrument: "{{ user.userpreference.primary_instrument }}",
      isLefty: {{ user.userpreference.is_lefty|yesno:"true,false" }},
      showAlternate: {{ user.userpreference.is_printing_alternate_chord|yesno:"true,false" }}
    };
  </script>
  {% else %}
  <script>
    window.userPreferences = { instrument: "ukulele", isLefty: false, showAlternate: false };
  </script>
  {% endif %}

  <script src="{% static 'songbook/js/chord_diagrams.js' %}"></script>
  <script src="{% static 'songbook/js/teleprompter.js' %}"></script>

  <style>

/* Navigation buttons */
.nav-zone {
  position: fixed;
  top: 50%;
  transform: translateY(-50%);
  font-size: 4rem;           /* bigger */
  color: rgba(255,255,255,0.8); /* bright white */
  text-decoration: none;
  z-index: 1000;
  transition: color 0.2s ease, transform 0.2s ease;
}
.nav-zone:hover {
  color: #ffffff;           /* pure white */
  transform: translateY(-50%) scale(1.1); /* pop effect */
}
.nav-left { left: 20px; }
.nav-right { right: 20px; }

/* Invisible tap zones for navigation */
.touch-zone {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 20%;
  z-index: 900; /* below controls, above content */
}

.touch-left {
  left: 0;
}

.touch-right {
  right: 0;
}

/* Optional: Add faint visual feedback for testing */
.touch-zone:active {
  background: rgba(255, 255, 255, 0.1);
}

  </style>
</head>
<body>

  <div class="controls">
    <div class="left">
      <span class="setlist-info">
        üéµ {{ setlist.name }} ‚Äî Song {{ song_order }} / {{ total_songs }}
      </span>
    </div>
  
    <div class="center">
      <button id="scroll-toggle">‚ñ∂Ô∏è Start</button>
      <div class="control-inline">
        Speed: <input type="range" id="scroll-speed" min="1" max="10" value="5">
      </div>
    </div>
  
    <div class="right">
      <button id="scroll-reset">‚èπ Reset</button>
  
      <!-- Song dropdown selector -->
      <select id="song-selector">
        {% for s in setlist.setlistsong_set.all %}
          <option value="{% url 'setlists:setlist_teleprompter' setlist.id s.order %}"
            {% if s.song.id == song.id %}selected{% endif %}>
            {{ s.order }}. {{ s.song.songTitle }}
          </option>
        {% endfor %}
      </select>
    </div>
  </div>
  

  <!-- Lyrics -->
  <div class="tp-main">
    <div class="lyrics-container">
      <div class="lyrics">
        <div class="metadata">
          <h1>{{ song.title }}</h1>
          {% if metadata.songwriter %}
            <div class="songwriter">{{ metadata.songwriter }}</div>
          {% endif %}
          {% if metadata.artist %}
            <div class="recording">
              {{ metadata.artist }}{% if metadata.year %} ({{ metadata.year }}){% endif %}
            </div>
          {% endif %}
        </div>

        {{ lyrics_with_chords|safe }}
      </div>
    </div>
  </div>

<!-- Touch zones for mobile navigation -->
{% if prev_song %}
<div class="touch-zone touch-left"
     onclick="window.location.href='{% url 'setlists:setlist_teleprompter' setlist.id prev_song.order %}'">
</div>
{% endif %}

{% if next_song %}
<div class="touch-zone touch-right"
     onclick="window.location.href='{% url 'setlists:setlist_teleprompter' setlist.id next_song.order %}'">
</div>
{% endif %}


  <!-- Chords JSON -->
  <script id="chords-data" type="application/json">
    {{ relevant_chords_json|safe }}
  </script>

  <script>
    // Keyboard navigation
    document.addEventListener("keydown", function(event) {
      if (event.key === "ArrowLeft") {
        const prev = document.querySelector(".nav-left");
        if (prev) prev.click();
      } else if (event.key === "ArrowRight") {
        const next = document.querySelector(".nav-right");
        if (next) next.click();
      }
    });
  </script>
  

  <!-- Chord Section -->
  <div id="chord-section">
    <div id="chord-diagrams"></div>
  </div>

 

</body>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const selector = document.getElementById("song-selector");
    if (selector) {
      selector.addEventListener("change", (e) => {
        window.location.href = e.target.value;
      });
    }
  });
</script>
</html>

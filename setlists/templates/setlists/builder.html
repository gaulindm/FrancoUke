<div class="row">
    <!-- Song Library -->
    <div class="col-md-6">
      <h4>Song Library</h4>
      <input type="text" id="song-search" placeholder="Search songs‚Ä¶" class="form-control mb-2">
      <ul id="song-list" class="list-group">
        {% for song in songs %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span>{{ song.songTitle }}</span>
          <button type="button" 
                  class="btn btn-sm btn-success add-song" 
                  data-id="{{ song.id }}" 
                  data-title="{{ song.songTitle }}">
            + Add
          </button>
        </li>
        {% endfor %}
      </ul>
    </div>
  
    <!-- Current Setlist -->
    <div class="col-md-6">
      <h4>Current Setlist</h4>
      <form method="post" id="setlist-form">
        {% csrf_token %}
        <input type="text" name="name" value="{{ setlist.name|default:'Untitled Setlist' }}" class="form-control mb-3">
  
        <ul id="setlist-songs" class="list-group">
          {% for item in setlist.setlistsong_set.all %}
          <li class="list-group-item d-flex align-items-center" data-id="{{ item.song.id }}">
            <span class="drag-handle me-2">‚ò∞</span>
            <strong>{{ item.song.songTitle }}</strong>
            <input type="hidden" name="order[]" value="{{ item.song.id }}">
  
            <input type="number" name="scroll_{{ item.song.id }}" value="{{ item.scroll_speed }}" 
                   placeholder="Scroll" class="form-control form-control-sm mx-2" style="width: 80px;">
            <input type="text" name="notes_{{ item.song.id }}" value="{{ item.rehearsal_notes }}" 
                   placeholder="Notes" class="form-control form-control-sm flex-grow-1 mx-2">
            <button type="button" class="btn btn-sm btn-danger remove-song">‚ùå</button>
          </li>
          {% endfor %}
        </ul>
  
        <button type="submit" class="btn btn-primary mt-3">üíæ Save Setlist</button>
      </form>
    </div>
  </div>
  <div class="row">
    <!-- Song Library -->
    <div class="col-md-6">
      <h4>Song Library</h4>
      <input type="text" id="song-search" placeholder="Search songs‚Ä¶" class="form-control mb-2">
      <ul id="song-list" class="list-group">
        {% for song in songs %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span>{{ song.songTitle }}</span>
          <button type="button" 
                  class="btn btn-sm btn-success add-song" 
                  data-id="{{ song.id }}" 
                  data-title="{{ song.songTitle }}">
            + Add
          </button>
        </li>
        {% endfor %}
      </ul>
    </div>
  
    <!-- Current Setlist -->
    <div class="col-md-6">
      <h4>Current Setlist</h4>
      <form method="post" id="setlist-form">
        {% csrf_token %}
        <input type="text" name="name" value="{{ setlist.name|default:'Untitled Setlist' }}" class="form-control mb-3">
  
        <ul id="setlist-songs" class="list-group">
          {% for item in setlist.setlistsong_set.all %}
          <li class="list-group-item d-flex align-items-center" data-id="{{ item.song.id }}">
            <span class="drag-handle me-2">‚ò∞</span>
            <strong>{{ item.song.songTitle }}</strong>
            <input type="hidden" name="order[]" value="{{ item.song.id }}">
  
            <input type="number" name="scroll_{{ item.song.id }}" value="{{ item.scroll_speed }}" 
                   placeholder="Scroll" class="form-control form-control-sm mx-2" style="width: 80px;">
            <input type="text" name="notes_{{ item.song.id }}" value="{{ item.rehearsal_notes }}" 
                   placeholder="Notes" class="form-control form-control-sm flex-grow-1 mx-2">
            <button type="button" class="btn btn-sm btn-danger remove-song">‚ùå</button>
          </li>
          {% endfor %}
        </ul>
  
        <button type="submit" class="btn btn-primary mt-3">üíæ Save Setlist</button>
      </form>
    </div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const setlistEl = document.getElementById("setlist-songs");
    
      // Make setlist draggable
      Sortable.create(setlistEl, {
        handle: ".drag-handle",
        animation: 150,
      });
    
      // Add song from library
      document.querySelectorAll(".add-song").forEach(btn => {
        btn.addEventListener("click", () => {
          const songId = btn.dataset.id;
          const songTitle = btn.dataset.title;
    
          // Prevent duplicate
          if (document.querySelector(`#setlist-songs li[data-id="${songId}"]`)) {
            alert("This song is already in the setlist.");
            return;
          }
    
          // Create new LI
          const li = document.createElement("li");
          li.className = "list-group-item d-flex align-items-center";
          li.dataset.id = songId;
          li.innerHTML = `
            <span class="drag-handle me-2">‚ò∞</span>
            <strong>${songTitle}</strong>
            <input type="hidden" name="order[]" value="${songId}">
            <input type="number" name="scroll_${songId}" placeholder="Scroll" 
                   class="form-control form-control-sm mx-2" style="width: 80px;">
            <input type="text" name="notes_${songId}" placeholder="Notes" 
                   class="form-control form-control-sm flex-grow-1 mx-2">
            <button type="button" class="btn btn-sm btn-danger remove-song">‚ùå</button>
          `;
          setlistEl.appendChild(li);
    
          // Rebind remove button
          li.querySelector(".remove-song").addEventListener("click", () => li.remove());
        });
      });
    
      // Remove existing songs
      document.querySelectorAll(".remove-song").forEach(btn => {
        btn.addEventListener("click", () => btn.closest("li").remove());
      });
    });
    </script>
     
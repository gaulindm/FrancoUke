{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ song.title }}</title>
    <link rel="stylesheet" href="{% static 'songbook/css/teleprompter.css' %}">
    <!-- Diagram renderer -->
    <script src="{% static 'songbook/js/chord_diagrams.js' %}"></script>
    <!-- Teleprompter engine -->
    <script src="{% static 'songbook/js/teleprompter.js' %}"></script>
</head>
<body>
    <!-- Controls -->
    <div class="controls">
        <div class="left">
            <span class="song-title">{{ song.title }}</span>
        </div>
        <div class="center">
            <button id="scroll-toggle">▶️ Start</button>
            <div class="control-inline">
                Speed: <input type="range" id="scroll-speed" min="1" max="10" value="5">
            </div>
        </div>
        <div class="right">
            <button id="scroll-reset">⏹ Reset</button>
        </div>
    </div>

    <!-- Lyrics -->
    <div class="tp-main">
        <div class="lyrics-container">
            <div class="lyrics">
                <div class="metadata">
                    <h1>{{ song.title }}</h1>
                    {% if metadata.songwriter %}
                        <div class="songwriter">{{ metadata.songwriter }}</div>
                    {% endif %}
                    {% if metadata.artist %}
                        <div class="recording">
                            {{ metadata.artist }}{% if metadata.year %} ({{ metadata.year }}){% endif %}
                        </div>
                    {% endif %}
                </div>

                {{ lyrics_with_chords|safe }}
            </div>
        </div>
    </div>

    <!-- Pass chords safely from backend -->
    <script id="chords-data" type="application/json">
        {{ relevant_chords_json|safe }}
    </script>

    <!-- ✅ Chord Diagrams (single section)
    <div id="chord-section" style="display: block; margin-top: 20px;">
        <button id="toggle-chords">Hide Chords</button>
        <h2 style="color: white;">Chord Diagrams</h2>
        <div id="chord-diagrams"></div>
    </div> -->

    <div id="chord-section" style="display: block;">
        <button id="toggle-chords">Hide Chords</button>
        <div id="chord-diagrams"></div>
      </div>

    <!-- Bootstrap Teleprompter -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        window.SONG = {
            id: "{{ song.id }}",
            title: "{{ song.title|escapejs }}",
            initialTranspose: 0,
            chords: JSON.parse(document.getElementById("chords-data").textContent)
        };

        console.log("Loaded SONG chords:", window.SONG.chords);

        // --- Show/Hide Toggle ---
        const btn = document.getElementById("toggle-chords");
        const container = document.getElementById("chord-diagrams");

        btn.addEventListener("click", () => {
            if (container.style.display === "none") {
                container.style.display = "block";
                btn.textContent = "Hide Chords";
            } else {
                container.style.display = "none";
                btn.textContent = "Show Chords";
            }
        });
    });
    </script>
</body>
</html>
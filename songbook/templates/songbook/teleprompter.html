{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ song.songTitle }}</title>
  <link rel="stylesheet" href="{% static 'songbook/css/teleprompter.css' %}">
  



  
  <!-- User Preferences -->
  <script>
    try {
      window.userPreferences = JSON.parse('{{ user_preferences_json|escapejs }}');
    } catch (e) {
      console.warn("‚ö†Ô∏è Could not parse user preferences JSON:", e);
      window.userPreferences = {};
    }
  
    // Safe numeric or string fallback
    window.initialScrollSpeed = {{ initial_scroll_speed|default:"20" }};
  </script>
  
  
  


  <!-- Diagram renderer -->
  <script src="{% static 'songbook/js/chord_diagrams.js' %}"></script>
  <!-- Teleprompter engine -->
  <script src="{% static 'songbook/js/teleprompter.js' %}"></script>
</head>
<body>
  <!-- Controls -->
  <div class="controls">
    <div class="left">
      <span class="song-title">{{ song.songTitle }}</span>
      <button id="toggle-chords">Hide Chords</button>
    </div>
    <div class="center">
      <button id="scroll-toggle">‚ñ∂Ô∏è Start</button>
      <!-- Sroll Speed adjustement -->
      <div class="control-inline">
        <span>Speed:</span>
        <button id="speed-decrease" class="speed-btn">‚àí</button>
        <span id="scroll-speed-display">{{ song.scroll_speed|default:30 }}</span>
        <button id="speed-increase" class="speed-btn">+</button>
        <button id="speed-save" class="speed-btn">üíæ Save</button>

      </div>
    </div>
    <div class="right">
      <button id="scroll-reset">‚èπ Reset</button>
    </div>
  </div>

  <!-- Lyrics -->
  <div class="tp-main">
    <div class="lyrics-container">
      <div class="lyrics">
        <div class="metadata">
          <h1>{{ song.songTitle }}</h1>
          {% if metadata.songwriter %}
            <div class="songwriter">{{ metadata.songwriter }}</div>
          {% endif %}
          {% if metadata.artist %}
            <div class="recording">
              {{ metadata.artist }}{% if metadata.year %} ({{ metadata.year }}){% endif %}
            </div>
          {% endif %}
        </div>
        {{ lyrics_with_chords|safe }}
      </div>
    </div>
  </div>

  <!-- Chords data -->
  <script id="chords-data" type="application/json">
    {{ relevant_chords_json|safe }}
  </script>

  <!-- Chord Section -->
  <div id="chord-section">
    <div id="chord-diagrams"></div>
  </div>

  <!-- Initialize SONG -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      window.SONG = {
        id: "{{ song.id }}",
        title: "{{ song.title|escapejs }}",
        initialTranspose: 0,
        chords: JSON.parse(document.getElementById("chords-data").textContent)
      };
      console.log("‚úÖ SONG loaded:", window.SONG);
    });
  </script>
</body>
</html>

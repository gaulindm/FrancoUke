{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <title>Teleprompter — {{ title }}</title>

  <link rel="stylesheet" href="{% static 'teleprompter/css/teleprompter.css' %}">
  <link rel="manifest" href="{% static 'teleprompter/manifest.json' %}">
  <meta name="theme-color" content="#111827">

  <script>
    // Pass song data into JS (escape properly)
    const SONG = {
      id: {{ song_id }},
      title: "{{ title|escapejs }}",
      lyrics: "{{ lyrics|escapejs }}",
      initialTranspose: {{ initial_transpose|default:"0" }}
    };
  </script>
</head>
<body>
  <div id="controls" class="controls">
    <div class="left">
      <button id="btn-back" onclick="window.close()" title="Close">←</button>
      <span class="song-title" id="song-title">{{ title }}</span>
    </div>

    <div class="center">
      <button id="btn-play" class="control-button">Play ▶</button>
      <button id="btn-stop" class="control-button">Stop ⏹</button>
      <label class="control-inline">Speed:
        <input id="speed" type="range" min="10" max="300" value="60">
        <span id="speed-value">60</span> px/s
      </label>
      <label class="control-inline">Font:
        <input id="font-size" type="range" min="18" max="120" value="54">
        <span id="font-value">54</span> px
      </label>
    </div>

    <div class="right">
      <button id="transpose-down" class="control-button">♭</button>
      <span id="transpose-value">0</span>
      <button id="transpose-up" class="control-button">♯</button>
      <button id="fullscreen" class="control-button">⤢</button>
    </div>
  </div>

  <main id="tp-main" class="tp-main">
    <div id="lyrics-container" class="lyrics-container" tabindex="0"></div>
    <div id="chords-diagrams" class="chords-diagrams"></div>
  </main>

  <script src="{% static 'teleprompter/js/teleprompter.js' %}"></script>

  <script>
    // try to register service worker for PWA (optional; will silently fail if file not served at that path)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register("{% static 'teleprompter/service-worker.js' %}")
        .catch(()=>console.log('Service worker register failed (ok in dev)'));
    }
  </script>
</body>
</html>
